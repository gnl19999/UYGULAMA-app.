<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnglishBox Quiz App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* GENEL AYARLAR */
        :root {
            --bg-light-gray: #f2f2f7;
            --color-primary: #3498db;
            --color-dark: #333;
            --color-light-gray: #eee;
            --color-yellow: #f1c40f;
            --color-red: #e74c3c;
            --color-green: #a3cb38;
            --color-icon-bg: #ecf0f1;
        }

        * { box-sizing: border-box; margin: 0; padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body {
            background-color: var(--bg-light-gray);
            display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
        }

        .mobile-container {
            width: 100%;
            max-width: 400px; background-color: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1); position: relative;
            overflow: hidden; min-height: 700px; padding-bottom: 0;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: flex-start; align-items: center;
            padding: 15px 20px; background-color: #fff;
            border-bottom: 1px solid var(--color-light-gray);
            position: sticky; top: 0; z-index: 10;
        }
        .header-content { display: flex; align-items: center;
        }
        header h1 { font-size: 18px; font-weight: bold; margin-left: 0;
        }
        .back-button {
            color: var(--color-dark);
            cursor: pointer; font-size: 18px;
            background: none; border: none; padding: 0; line-height: 1; margin-right: 15px;
        }

        /* SAYFA YAPISI */
        .page { display: none;
        opacity: 0; transition: opacity 0.3s ease; width: 100%; }
        .page.active { display: block;
        opacity: 1; }
        
        #unit-detail-page.active, #word-detail-page.active {
            display: flex;
            flex-direction: column; height: 100%; position: relative; padding-bottom: 70px;
        }
        
        /* KART STİLLERİ */
        .card {
            background: #fff;
            margin: 15px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid var(--color-light-gray);
            overflow: hidden; cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .card:active { transform: scale(0.99);
        }
        .card:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .card-content { padding: 15px; display: flex; align-items: center;
        }
        .card-icon-wrapper {
            width: 60px;
            height: 60px; border-radius: 50%; margin-right: 15px;
            display: flex; align-items: center; justify-content: center; color: #fff; font-size: 24px; flex-shrink: 0;
        }
        .icon-verb { background-color: #34495e;
        }
        .icon-noun { background-color: #e91e63;
        }
        .icon-adj { background-color: var(--color-green);
        }
        .icon-adv { background-color: #e67e22;
        }
        .icon-conj { background-color: #9b59b6;
        }
        .icon-phrasal { background-color: var(--color-primary);
        }
        .card-info { flex-grow: 1;
        }
        .card-info h3 { font-size: 16px; margin-bottom: 5px; color: var(--color-dark);
        }
        .card-info p { font-size: 13px; color: #888; margin-bottom: 8px;
        }
        .progress-bar { height: 6px; background-color: var(--color-light-gray); border-radius: 3px; width: 100%;
        }
        .progress-fill { height: 100%; background-color: var(--color-primary); width: 0%; border-radius: 3px;
        transition: width 0.5s ease; } 
        .btn-continue {
            width: 100%;
            padding: 12px; background: #fff; border: none;
            border-top: 1px solid var(--color-light-gray); color: var(--color-dark);
            font-weight: bold; font-size: 14px; cursor: pointer; text-transform: uppercase;
            transition: background 0.2s, color 0.2s;
        }
        .btn-continue:hover { background-color: #f5f5f5;
        }

        /* DETAY SAYFASI */
        .stats-row { display: flex;
        justify-content: space-around; padding: 20px 10px; background: #fff; margin-bottom: 10px; }
        .stat-item { display: flex;
        flex-direction: column; align-items: center; text-align: center; width: 30%; cursor: pointer; padding: 5px;
        }
        .stat-icon-circle { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center;
        justify-content: center; color: #fff; font-size: 20px; margin-bottom: 8px; }
        .stat-text { font-size: 11px;
        color: #666; line-height: 1.2; }
        .bg-yellow { background-color: var(--color-yellow);
        }
        .bg-red { background-color: var(--color-red);
        }
        .bg-green { background-color: var(--color-green);
        }
        .percentage-row {
            display: flex;
            justify-content: space-between; padding: 10px 20px; background: #fff;
            font-weight: bold; font-size: 14px; margin-bottom: 20px;
            border-top: 1px solid var(--color-light-gray);
            border-bottom: 1px solid var(--color-light-gray);
        }
        .percentage-row .percentage-value { color: #f39c12;
        }
        .percentage-row .label { font-weight: normal; color: #666; font-size: 12px;
        }

        /* Timeline / Ünite Listesi */
        .timeline { padding: 0 20px;
        }
        .unit-item {
            display: flex;
            align-items: center; position: relative; padding: 15px 10px;
            cursor: pointer; transition: background-color 0.2s; border-radius: 8px; margin-bottom: 8px;
            opacity: 1; background-color: #fff;
            border: 1px solid var(--color-light-gray);
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .unit-item.selected { background-color: #f0f8ff;
        border: 1px solid #cceeff; }
        .unit-item:hover { background-color: #f9f9f9;
        }
        .unit-circle {
            width: 40px;
            height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: #fff; font-weight: bold; flex-shrink: 0; z-index: 2;
        }
        .unit-content { margin-left: 15px;
        }
        .unit-title { font-weight: bold; color: var(--color-dark); font-size: 16px;
        }
        .unit-subtitle { font-size: 13px; color: #999; margin-top: 4px;
        }
        
        .u1, .u6, .u11, .u16 { background-color: #e91e63;
        }
        .u2, .u7, .u12, .u17 { background-color: var(--color-primary);
        }
        .u3, .u8, .u13, .u18 { background-color: #000;
        }
        .u4, .u9, .u14, .u19 { background-color: var(--color-green);
        }
        .u5, .u10, .u15, .u20 { background-color: #e67e22;
        }

        /* ÜNİTE DETAY & KELİME LİSTESİ */
        .unit-detail-info { padding: 20px;
        text-align: center; flex-shrink: 0; }
        .unit-progress-circle {
            width: 120px;
            height: 120px; border-radius: 50%; background-color: var(--color-primary);
            color: #fff; font-size: 36px; font-weight: bold; display: flex; align-items: center;
            justify-content: center;
            margin: 0 auto 10px auto;
        }
        .unit-detail-info p { font-size: 14px; color: #888;
        margin-bottom: 10px; height: 18px; }
        .unit-detail-info .word-count-info { font-size: 16px; font-weight: bold;
        color: var(--color-dark); margin-top: 10px; }
        
        .bottom-actions { 
            position: fixed;
            bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 400px;
            background-color: #fff; padding: 15px 20px; box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            z-index: 100; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0;
        }
        .action-button {
            width: 100%;
            padding: 15px; border: none; border-radius: 12px; font-size: 16px;
            font-weight: bold; color: #fff; cursor: pointer; display: flex; align-items: center;
            justify-content: center;
            gap: 10px; margin: 0;
        }
        .btn-quiz { background-color: var(--color-green);
        }
        .btn-back-to-list { background-color: var(--color-primary);
        } 

        .unit-word-list { padding: 0 15px 10px 15px; overflow-y: auto; flex-grow: 1;
        }
        
        .word-item { display: flex;
        align-items: center; padding: 10px 0; border-bottom: 1px solid var(--color-light-gray); cursor: pointer;
        } 
        .word-item:last-child { border-bottom: none;
        }
        
        .word-icon-placeholder {
            width: 50px;
            height: 50px; border-radius: 8px; margin-right: 15px;
            display: flex; align-items: center; justify-content: center; background-color: var(--color-icon-bg);
            color: var(--color-primary); font-size: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .word-text-group { display: flex;
        flex-direction: column; }
        .word-english { font-weight: bold; color: var(--color-dark); font-size: 16px; text-transform: capitalize;
        }
        .word-turkish { font-size: 14px; color: #888; text-transform: lowercase;
        }

        /* QUIZ SAYFASI */
        #quiz-page { display: flex;
        flex-direction: column; padding: 0 20px; text-align: center; }
        .quiz-header-word { padding: 30px 0;
        margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
        .quiz-speaker-icon { font-size: 36px;
        color: var(--color-yellow); margin-bottom: 10px; cursor: pointer; }
        #quiz-question-text { font-size: 32px; color: var(--color-dark);
        font-weight: bold; margin: 0; text-transform: capitalize; }
        #quiz-question-counter { font-size: 14px; color: #999;
        margin-top: 10px; font-weight: normal; }
        .options-container { display: flex; flex-direction: column; gap: 15px;
        }
        .quiz-option {
            padding: 20px 15px;
            background-color: #fff; border: 1px solid var(--color-light-gray);
            border-radius: 12px; text-align: center; font-weight: bold; font-size: 16px; color: var(--color-dark);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.1s;
        }
        .quiz-option:active:not(.answered) { transform: scale(0.98); }
        .quiz-option.correct { background-color: var(--color-green); color: white; border-color: var(--color-green); pointer-events: none;
        animation: pulse-correct 0.5s ease; }
        .quiz-option.incorrect { background-color: var(--color-red); color: white; border-color: var(--color-red);
        pointer-events: none; animation: shake-incorrect 0.3s ease; }
        .options-container.answered .quiz-option:not(.correct):not(.incorrect) { opacity: 0.5;
        pointer-events: none; }
        .quiz-results {
            margin-top: 50px;
            padding: 20px; background-color: var(--bg-light-gray); border-radius: 15px; text-align: center;
        }
        .results-score-circle {
            width: 100px;
            height: 100px; border-radius: 50%; background-color: var(--color-green);
            color: white; font-size: 28px; font-weight: bold; display: flex; align-items: center;
            justify-content: center;
            margin: 20px auto; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* KELİME DETAY SAYFASI */
        .word-detail-content { padding: 20px;
        display: flex; flex-direction: column; align-items: center; }
        #word-icon-main {
            width: 150px;
            height: 150px; border-radius: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); background-color: var(--color-icon-bg);
            color: var(--color-primary); display: flex; align-items: center;
            justify-content: center; font-size: 70px;
        }
        .word-main-info { text-align: center; margin-bottom: 20px;
        }
        #detail-english-word { font-size: 30px; font-weight: bold; color: var(--color-dark); text-transform: capitalize; display: inline-block;
        margin-right: 10px; }
        #detail-turkish-word { font-size: 18px; color: var(--color-primary); font-weight: 500; display: block;
        margin-top: 5px; }
        .example-section {
            background-color: var(--bg-light-gray);
            padding: 15px; border-radius: 12px; width: 100%;
            text-align: left; margin-bottom: 20px; border-left: 5px solid var(--color-yellow);
        }
        .example-section h4 { font-size: 16px; color: var(--color-dark); margin-bottom: 10px; display: flex;
        align-items: center; gap: 8px; }
        .example-sentence-en { font-style: italic; font-size: 15px; line-height: 1.5;
        color: #555; margin-bottom: 8px; }
        .example-sentence-tr { font-size: 14px; line-height: 1.5; color: #999;
        margin-top: -5px; }
        .speaker-icon-small { color: var(--color-dark); cursor: pointer; font-size: 20px; margin-left: 10px;
        }

        @keyframes pulse-correct { 0% { transform: scale(1); } 50% { transform: scale(1.05);
        } 100% { transform: scale(1); } }
        @keyframes shake-incorrect { 0%, 100% { transform: translateX(0);
        } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px);
        } }
    </style>
</head>
<body>

    <div class="mobile-container">
        
        <header>
            <div class="header-content">
                <button id="back-button" class="back-button" style="display: none;"
                data-page-level="1">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1></h1> 
            </div>
        </header>

        <div id="home-page" class="page active">
            <div class="card"><div 
                class="card-content"><div class="card-icon-wrapper icon-verb"><i class="fas fa-book-open"></i></div><div class="card-info"><h3>İleri Düzey Akademik Fiiller</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="İleri Düzey Akademik Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-verb"><i class="fas fa-running"></i></div><div class="card-info"><h3>Akademik Fiiller</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-adj"><i class="fas fa-star"></i></div><div class="card-info"><h3>Akademik Sıfatlar</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Sıfatlar">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-noun"><i class="fas 
                fa-building"></i></div><div class="card-info"><h3>Akademik İsimler</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" 
                data-card-title="Akademik İsimler">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-conj"><i class="fas fa-link"></i></div><div class="card-info"><h3>Akademik Bağlaçlar</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Bağlaçlar">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-phrasal"><i class="fas fa-dice"></i></div><div class="card-info"><h3>Öbek Fiiller</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Öbek Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-adv"><i class="fas fa-clock"></i></div><div class="card-info"><h3>Akademik Zarflar</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" 
                data-card-title="Akademik Zarflar">DEVAM ET</button></div>
            <div class="card"><div 
                class="card-content"><div class="card-icon-wrapper icon-noun"><i class="fas fa-users"></i></div><div class="card-info"><h3>En Çok Kullanılan İsimler</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="En Çok Kullanılan İsimler">DEVAM ET</button></div>
        </div>

        <div id="detail-page" class="page">
            <div class="stats-row">
                 <div class="stat-item" onclick="startSpecialQuiz('forgotten')"><div class="stat-icon-circle bg-yellow"><i class="fas fa-thumbtack"></i></div><div class="stat-text">Unutulabilecek<br>Kelimeler</div></div>
   
                 <div class="stat-item" onclick="startSpecialQuiz('frequently_wrong')"><div class="stat-icon-circle 
                bg-red"><i class="fas fa-times"></i></div><div class="stat-text">Sık Yanlış<br>Cevaplananlar</div></div>
                <div class="stat-item" onclick="startSpecialQuiz('mixed_review')"><div class="stat-icon-circle bg-green"><i class="fas fa-random"></i></div><div class="stat-text">Karışık Tekrar<br>Çalışması</div></div>
            </div>
            <div class="percentage-row">
                <div class="percentage-item"><span class="percentage-value" id="detail-correct-rate">% 10</span> <span 
                class="label">Doğru yanıtlar</span></div>
                <div class="percentage-item"><span class="percentage-value" id="detail-learned-rate">% 5</span> 
                <span class="label">Öğrenilenlerin oranı</span></div>
            </div>
            <div class="timeline"></div>
        </div>

        <div id="unit-detail-page" class="page">
            <div class="unit-detail-info">
            
                <div class="unit-progress-circle" id="detail-unit-circle">1</div>
                <p id="detail-unit-progress" class="word-count-info"></p>
      
              </div>
             <div class="unit-word-list" id="word-list-container"></div>
            <div class="bottom-actions">
                <button class="action-button btn-quiz" onclick="startQuiz()">
         
                    <i class="fas fa-question-circle"></i> Quiz Çöz
                </button>
      
              </div>
        </div>
        
        <div id="word-detail-page" class="page">
            <div class="word-detail-content">
         
                <div id="word-icon-main"><i class="fas fa-cube"></i></div>
                <div class="word-main-info">
                   
                    <span id="detail-english-word"></span>
                    <i class="fas fa-volume-up speaker-icon-small" onclick="alert('Seslendirildi!')"></i>
                    
                    <span id="detail-turkish-word"></span>
                </div>
                <div class="example-section">
                <h4><i class="fas fa-lightbulb"></i> Örnek 
                Cümle</h4>
                    <p id="example-sentence-en" class="example-sentence-en"></p>
                
                    <p id="example-sentence-tr" class="example-sentence-tr"></p>
                </div>
            </div>
            <div class="bottom-actions">
               
              <button class="action-button btn-back-to-list" onclick="goBack()">
                    <i 
                class="fas fa-list-ul"></i> Kelime Listesine Dön
                </button>
            </div>
        </div>

        <div id="quiz-page" class="page">
            <div class="quiz-header-word">
           
               <i class="fas fa-volume-up quiz-speaker-icon" onclick="alert('Seslendirildi!')"></i>
       
                 <h3 id="quiz-question-text"></h3>
                 <p id="quiz-question-counter"></p>
            </div>
            <div id="quiz-options" class="options-container">
            </div>
        </div>

    </div>

    <script>
  
        // === GÜNCEL VE ZENGİNLEŞTİRİLMİŞ VERİ BÖLÜMÜ ===

        const realWordData = {
            "İleri Düzey Akademik Fiiller": {
                1: [
                    { en: "Analyze", tr: "Analiz Etmek" }, { en: "Identify", tr: "Tanımlamak, Belirlemek" },
                    { en: "Determine", tr: "Saptamak, Karar Vermek" }, { en: "Establish", tr: "Kurmak, Oluşturmak, Saptamak" },
                    { en: "Investigate", tr: "Araştırmak, İncelemek" }, { en: "Illustrate", tr: "Örneklemek, Açıklamak" },
                    { en: "Demonstrate", tr: "Göstermek, Kanıtlamak" }, { en: "Evaluate", tr: "Değerlendirmek" },
                    { en: "Synthesize", tr: "Sentezlemek" }, { en: "Formulate", tr: "Formüle Etmek, Geliştirmek" },
                    { en: "Define", tr: "Tanımlamak" }, { en: "Compare", tr: "Karşılaştırmak" },
                    { en: "Contrast", tr: "Karşıtlık Kurmak, Farklılıkları Belirtmek" }, { en: "Argue", tr: "Tartışmak, İddia Etmek" },
                    { en: "Support", tr: "Desteklemek" }, { en: "Challenge", tr: "Sorgulamak, Meydan Okumak" },
                    { en: "Derive", tr: "Türetmek, Elde Etmek" }, { en: "Indicate", tr: "İşaret Etmek, Göstermek" },
                    { en: "Suggest", tr: "Öne Sürmek, Önermek" }, { en: "Conclude", tr: "Sonuçlandırmak" }
                ],
                2: [
                    { en: "Perceive", tr: "Algılamak" }, { en: "Propose", tr: "Teklif Etmek, Önermek" },
                    { en: "Observe", tr: "Gözlemlemek" }, { en: "Examine", tr: "İncelemek, Muayene Etmek" },
                    { en: "Apply", tr: "Uygulamak" }, { en: "Implement", tr: "Uygulamaya Koymak" },
                    { en: "Reflect", tr: "Yansıtmak, Düşünmek" }, { en: "Relate", tr: "İlişkilendirmek" },
                    { en: "Discuss", tr: "Tartışmak" }, { en: "Differentiate", tr: "Ayırt Etmek, Farklılaştırmak" },
                    { en: "Validate", tr: "Doğrulamak, Onaylamak" }, { en: "Generate", tr: "Üretmek, Oluşturmak" },
                    { en: "Evolve", tr: "Gelişmek, Evrilmek" }, { en: "Comprise", tr: "İçermek, Kapsamak" },
                    { en: "Precede", tr: "Önce Gelmek" }, { en: "Succeed", tr: "Başarılı Olmak, Yerine Geçmek" },
                    { en: "Cite", tr: "Alıntı Yapmak" }, { en: "Integrate", tr: "Bütünleştirmek" },
                    { en: "Modify", tr: "Değiştirmek, Uyarlamak" }, { en: "Replicate", tr: "Tekrarlamak, Çoğaltmak" }
                ],
                3: [
                    { en: "Signify", tr: "İfade Etmek, Anlamına Gelmek" }, { en: "Account for", tr: "Açıklamak, Sorumlu Olmak" },
                    { en: "Assess", tr: "Değer Biçmek, Değerlendirmek" }, { en: "Contribute", tr: "Katkıda Bulunmak" },
                    { en: "Correlate", tr: "İlişkilendirmek, Korelasyon Kurmak" }, { en: "Emphasize", tr: "Vurgulamak" },
                    { en: "Extract", tr: "Çıkarmak, Özütlemek" }, { en: "Hypothesize", tr: "Hipotez Kurmak" },
                    { en: "Justify", tr: "Gerekçelendirmek" }, { en: "Reveal", tr: "Ortaya Çıkarmak, Açığa Vurmak" },
                    { en: "Envisage", tr: "Öngörmek, Zihninde Canlandırmak" }, { en: "Exclude", tr: "Hariç tutmak, Dışlamak" },
                    { en: "Expend", tr: "Harcamak, Tüketmek (kaynak, zaman)" }, { en: "Facilitate", tr: "Kolaylaştırmak" },
                    { en: "Fluctuate", tr: "Dalgalanmak, İnip çıkmak" }, { en: "Foster", tr: "Geliştirmek, Teşvik etmek, Beslemek" },
                    { en: "Globalize", tr: "Küreselleştirmek" }, { en: "Guarantee", tr: "Garanti etmek" },
                    { en: "Hinder", tr: "Engellemek, Önlemek" }, { en: "Imply", tr: "Kastetmek, İma etmek, Çıkarım Yapmak" }
                ],
                4: [
                    { en: "Incur", tr: "Maruz kalmak, Uğramak (masraf, zarar)" }, { en: "Infer", tr: "Çıkarım yapmak, Sonuç çıkarmak" },
                    { en: "Inhibit", tr: "Engellemek, Ket vurmak" }, { en: "Initiate", tr: "Başlatmak, Girişimde bulunmak" },
                    { en: "Innovate", tr: "Yenilik yapmak" }, { en: "Insert", tr: "Eklemek, Sokmak, Araya koymak" },
                    { en: "Intervene", tr: "Müdahale etmek, Araya girmek" }, { en: "Isolate", tr: "İzole etmek, Ayırmak" },
                    { en: "Juxtapose", tr: "Yan yana koymak, Karşılaştırmak" }, { en: "Legislate", tr: "Yasa çıkarmak, Yasalaştırmak" },
                    { en: "Liaise", tr: "İrtibat kurmak, Bağlantı sağlamak" }, { en: "Mandate", tr: "Yetki vermek, Zorunlu kılmak" },
                    { en: "Mediate", tr: "Arabuluculuk yapmak" }, { en: "Merge", tr: "Birleştirmek, Kaynaşmak" },
                    { en: "Minimize", tr: "Asgariye indirmek, Küçültmek" }, { en: "Negate", tr: "Yadsımak, Geçersiz kılmak" },
                    { en: "Negotiate", tr: "Müzakere etmek, Görüşmek" }, { en: "Obtain", tr: "Elde etmek, Edinmek" },
                    { en: "Occur", tr: "Meydana gelmek, Oluşmak" }, { en: "Omit", tr: "Atlamak, Hariç bırakmak" }
                ],
                5: [
                    { en: "Oversee", tr: "Denetlemek, Gözetlemek" }, { en: "Parallel", tr: "Paralellik kurmak" },
                    { en: "Participate", tr: "Katılmak" }, { en: "Permit", tr: "İzin vermek" },
                    { en: "Pertain", tr: "İlişkili olmak, Ait olmak" }, { en: "Phase", tr: "Aşamalara ayırmak" },
                    { en: "Postulate", tr: "Varsaymak, Öncül olarak kabul etmek" }, { en: "Precede", tr: "Önce gelmek" },
                    { en: "Predict", tr: "Tahmin etmek, Yordamak" }, { en: "Prescribe", tr: "Önermek, Reçetelemek, Emretmek" },
                    { en: "Presume", tr: "Varsaymak, Sanmak" }, { en: "Prevail", tr: "Yaygın olmak, Baskın çıkmak" },
                    { en: "Proceed", tr: "Devam etmek, İlerlemek" }, { en: "Prohibit", tr: "Yasaklamak" },
                    { en: "Project", tr: "Yansıtmak, Tahmin etmek" }, { en: "Promote", tr: "Desteklemek, Teşvik etmek, Tanıtmak" },
                    { en: "Purport", tr: "İddia etmek, Görünmek" }, { en: "Qualify", tr: "Niteliklerini belirtmek, Sınırlamak" },
                    { en: "Recast", tr: "Yeniden biçimlendirmek, Tekrar düzenlemek" }, { en: "Reconcile", tr: "Uyumlaştırmak, Uyuşmasını sağlamak" }
                ],
                6: [
                    { en: "Recourse", tr: "Başvurmak, Çare aramak" }, { en: "Redress", tr: "Gidermek, Telafi etmek" },
                    { en: "Refute", tr: "Çürütmek, Yalanlamak" }, { en: "Regulate", tr: "Düzenlemek, Ayarlamak" },
                    { en: "Relegate", tr: "Daha aşağı bir konuma indirmek" }, { en: "Remit", tr: "Affetmek..."},
                ]
            },
            "Akademik Fiiller": {
                 1: [
                    { en: "Acquire", tr: "Edinmek, Kazanmak" }, { en: "Adapt", tr: "Uyum sağlamak" },
                    { en: "Adjust", tr: "Ayarlamak, Düzeltmek" }, { en: "Advance", tr: "İlerlemek, Gelişmek" },
                    { en: "Affirm", tr: "Onaylamak, Doğrulamak" }, { en: "Allocate", tr: "Tahsis etmek" },
                    { en: "Amend", tr: "Değişiklik yapmak" }, { en: "Anticipate", tr: "Öngörmek" },
                    { en: "Appreciate", tr: "Değerini anlamak" }, { en: "Assimilate", tr: "Özümsemek" },
                ],
                2: [
                    { en: "Comprehend", tr: "Kavramak" }, { en: "Conceive", tr: "Tasarlamak, Düşünmek" },
                    { en: "Conduct", tr: "Yürütmek, İdare etmek" }, { en: "Constitute", tr: "Oluşturmak" },
                    { en: "Consume", tr: "Tüketmek" }, { en: "Contend", tr: "İddia etmek" },
                    { en: "Convene", tr: "Toplanmak" }, { en: "Corroborate", tr: "Doğrulamak, Onaylamak" },
                    { en: "Critique", tr: "Eleştirmek" }, { en: "Cultivate", tr: "Yetiştirmek, Geliştirmek" }
                ],
                3: [
                    { en: "Decline", tr: "Reddetmek, Azalmak" }, { en: "Deduce", tr: "Tümdengelimle sonuç çıkarmak" },
                    { en: "Defer", tr: "Ertelemek" }, { en: "Denounce", tr: "Kınamak" },
                    { en: "Depict", tr: "Tasvir etmek" }, { en: "Devise", tr: "Tasarlamak, İcat etmek" },
                    { en: "Disseminate", tr: "Yayınlamak, Yaymak" }, { en: "Distort", tr: "Çarpıtmak" },
                    { en: "Document", tr: "Belgelemek" }, { en: "Elicit", tr: "Ortaya çıkarmak, Sağlamak" }
                ],
                4: [
                    { en: "Elucidate", tr: "Açıklamak, Aydınlatmak" }, { en: "Embody", tr: "Temsil etmek, İçermek" },
                    { en: "Emerge", tr: "Ortaya çıkmak" }, { en: "Encompass", tr: "Kapsamak" },
                    { en: "Endorse", tr: "Onaylamak, Desteklemek" }, { en: "Enhance", tr: "Geliştirmek, Artırmak" },
                    { en: "Equate", tr: "Eşitlemek, Denk saymak" }, { en: "Exemplify", tr: "Örneklemek" },
                    { en: "Explicate", tr: "Açıklamak" }, { en: "Exploit", tr: "Faydalanmak, Sömürmek" }
                ]
            },
            "Akademik Sıfatlar": { 
                1: [
                    { en: "Abstract", tr: "Soyut" }, { en: "Coherent", tr: "Tutarlı, Uyumlu" },
                    { en: "Comprehensive", tr: "Kapsamlı" }, { en: "Crucial", tr: "Çok önemli" },
                    { en: "Empirical", tr: "Deneysel" }, { en: "Explicit", tr: "Açık, Net" },
                    { en: "Fundamental", tr: "Temel" }, { en: "Implicit", tr: "Kapalı, İmalı" },
                    { en: "Intrinsic", tr: "Doğal, Özde" }, { en: "Paradoxical", tr: "Paradoksal" }
                ],
                2: [
                    { en: "Ambiguous", tr: "Belirsiz" }, { en: "Conclusive", tr: "Kesin, Sonuç veren" },
                    { en: "Conformist", tr: "Uyumcu" }, { en: "Constitutive", tr: "Oluşturan" },
                    { en: "Contextual", tr: "Bağlamsal" }, { en: "Contingent", tr: "Bağlı, Şarta bağlı" },
                    { en: "Contradictory", tr: "Çelişkili" }, { en: "Conventional", tr: "Geleneksel, Alışılagelmiş" },
                    { en: "Crucial", tr: "Çok önemli, Hayati" }, { en: "Cumulative", tr: "Kümülatif, Birikimli" }
                ],
                3: [
                    { en: "Decisive", tr: "Belirleyici, Kesin" }, { en: "Deductive", tr: "Tümdengelimsel" },
                    { en: "Definitive", tr: "Kesin, Tanımlayıcı" }, { en: "Descriptive", tr: "Tanımlayıcı, Betimleyici" },
                    { en: "Detrimental", tr: "Zararlı, Olumsuz" }, { en: "Dialectical", tr: "Diyalektik" },
                    { en: "Differential", tr: "Farklı, Ayırt edici" }, { en: "Discreet", tr: "Tedbirli, İhtiyatlı (gizli)" },
                    { en: "Disparate", tr: "Farklı, Benzersiz" }, { en: "Distorted", tr: "Çarpıtılmış, Bozulmuş" },
                    { en: "Dominant", tr: "Baskın, Hakim" }, { en: "Empirical", tr: "Deneysel, Deneyime dayalı" }
                ]
            },
            "Akademik İsimler": {
                1: [
                    { en: "Concept", tr: "Kavram" }, { en: "Hypothesis", tr: "Hipotez" },
                    { en: "Framework", tr: "Çerçeve" }, { en: "Methodology", tr: "Metodoloji" },
                    { en: "Variable", tr: "Değişken" }, { en: "Assumption", tr: "Varsayım" },
                    { en: "Implication", tr: "Çıkarım, Sonuç" }, { en: "Validity", tr: "Geçerlilik" },
                    { en: "Bias", tr: "Önyargı" }, { en: "Paradigm", tr: "Paradigma" }
                ]
            },
            "Akademik Bağlaçlar": {
                1: [
                    { en: "However", tr: "Ancak, Yine de" }, { en: "Moreover", tr: "Dahası, Üstelik" },
                    { en: "Therefore", tr: "Bu nedenle, Sonuç olarak" }, { en: "In contrast", tr: "Aksine" },
                    { en: "Furthermore", tr: "Ayrıca" }, { en: "Consequently", tr: "Sonuç olarak" },
                    { en: "Nevertheless", tr: "Yine de" }, { en: "Thus", tr: "Böylece" },
                ]
            },
            "Öbek Fiiller": {
                1: [
                    { en: "Point out", tr: "İşaret etmek, Belirtmek" }, { en: "Set up", tr: "Kurmak, Ayarlamak" },
                    { en: "Carry out", tr: "Yürütmek, Gerçekleştirmek" }, { en: "Look into", tr: "İncelemek, Araştırmak" },
                    { en: "Take up", tr: "Başlamak (hobi), Yer kaplamak" }, { en: "Find out", tr: "Öğrenmek, Bulmak" }
                ]
            }, 
            "Akademik Zarflar": { 
                1: [ 
                    { en: "Significantly", tr: "Önemli ölçüde" }, { en: "Consequently", tr: "Sonuçsal olarak" }, 
                    { en: "Primarily", tr: "Öncelikle, Başlıca" }, { en: "Subsequently", tr: "Daha sonra, Ardından" }, 
                    { en: "Necessarily", tr: "Mutlaka, Zorunlu olarak" }, { en: "Conversely", tr: "Aksine, Tersine" } 
                ] 
            }, 
            "En Çok Kullanılan İsimler": { 
                1: [ 
                    { en: "Environment", tr: "Çevre" }, { en: "Issue", tr: "Mesele, Konu" }, 
                    { en: "Method", tr: "Yöntem" }, { en: "Data", tr: "Veri" }, 
                    { en: "Structure", tr: "Yapı" } 
                ] 
            } 
        };

        // === GLOBAL DEĞİŞKENLER VE İLK TANIMLAR ===
        const cardUnitData = {}; 
        let currentCategoryTitle = null; 
        let currentUnitNumber = null;
        let currentUnitWords = []; 
        let currentQuiz = []; 
        let currentQuestionIndex = 0; 
        let score = 0; 
        let totalQuestions = 0;
        let navigationStack = []; // { id: 'home-page', title: 'EnglishBox', level: 0 }

        // DOM Elementleri
        const headerTitle = document.querySelector('header h1'); 
        const backButton = document.getElementById('back-button'); 
        const unitTimeline = document.querySelector('.timeline');
        const wordListContainer = document.getElementById('word-list-container'); 
        const quizOptionsContainer = document.getElementById('quiz-options'); 
        const cards = document.querySelectorAll('#home-page .card');
        
        // Geniş bir Türkçe çeviri havuzu (Yanlış şıklar için)
        const globalTranslationPool = [
            "etkilemek", "uyum", "değişim", "gelişme", "sistem", "bölüm", "yöntem", "veri", "analiz", 
            "sonuç", "öğrenme", "çözüm", "amaç", "süreç", "kavram", "uygulama", "farklılaşma", 
            "tanımlama", "değerlendirme", "eleştiri", "örnek", "tahmin", "yargılama", "ortaklık", 
            "benzerlik", "destek", "karşı çıkmak", "türetme", "öneri", "sonuçlandırma", "gözlem", 
            "doğrulama", "üretme", "evrim", "içerme", "önce gelme", "başarı", "alıntı", "bütünleştirme", 
            "değiştirme", "tekrarlama", "açıklama", "katkı", "korelasyon", "vurgulama", "çıkarma", 
            "hipotez", "gerekçe", "ortaya çıkarma", "öngörme", "hariç tutma", "harcama", "kolaylaştırma", 
            "dalgalanma", "teşvik etme", "küreselleştirme", "garanti", "engelleme", "ima etme", 
            "maruz kalma", "çıkarım", "yasaklama", "başlatma", "yenilik", "ekleme", "müdahale", 
            "izole etme", "yan yana koyma", "yasalaştırma", "irtibat", "yetkilendirme", "arabuluculuk", 
            "birleştirme", "küçültme", "yadsıma", "müzakere", "edinme", "oluşma", "atlama", "denetleme", 
            "paralel", "katılma", "izin verme", "ilişkili olma", "aşama", "varsayma", "tahmin etme", 
            "önerme", "sanma", "yaygın olma", "devam etme", "yasaklama", "yansıtma", "tanıtma", 
            "iddia etme", "nitelik", "yeniden biçimlendirme", "uyumlaştırma", "başvurma", "telafi etme", 
            "çürütme", "düzenleme", "indirme", "affetme"
        ];
        
        // === KELİME YARDIMCI FONKSİYONLAR ===
        function getWordIcon(word) {
            const wordLower = word.toLowerCase();
            // Varsayılan
            if (wordLower.includes("analysis") || wordLower.includes("calculate") || wordLower.includes("determine") || wordLower.includes("quantify")) return "fas fa-calculator";
            // Hesaplama, Karar
            if (wordLower.includes("establish") || wordLower.includes("found") || wordLower.includes("base") || wordLower.includes("derive")) return "fas fa-balance-scale";
            // Kurma, Temel
            if (wordLower.includes("investigate") || wordLower.includes("research") || wordLower.includes("examine") || wordLower.includes("survey")) return "fas fa-search";
            // Araştırma, İnceleme
            if (wordLower.includes("illustrate") || wordLower.includes("demonstrate") || wordLower.includes("show")) return "fas fa-chart-bar";
            // Gösterme, İllüstrasyon
            if (wordLower.includes("evaluate") || wordLower.includes("assess") || wordLower.includes("critique")) return "fas fa-star-half-alt";
            // Değerlendirme, Eleştiri
            if (wordLower.includes("synthesize") || wordLower.includes("integrate") || wordLower.includes("combine")) return "fas fa-flask";
            // Sentez, Bütünleştirme
            if (wordLower.includes("formulate") || wordLower.includes("propose") || wordLower.includes("devise")) return "fas fa-puzzle-piece";
            // Geliştirme, Önerme
            if (wordLower.includes("define") || wordLower.includes("identify")) return "fas fa-tag";
            // Tanımlama, Etiketleme
            if (wordLower.includes("compare") || wordLower.includes("contrast") || wordLower.includes("differentiate") || wordLower.includes("juxtapose") || wordLower.includes("parallel")) return "fas fa-exchange-alt";
            // Karşılaştırma, Farklılaştırma
            if (wordLower.includes("argue") || wordLower.includes("support") || wordLower.includes("refute") || wordLower.includes("challenge") || wordLower.includes("contend")) return "fas fa-gavel";
            // Tartışma, İddia
            if (wordLower.includes("indicate") || wordLower.includes("suggest") || wordLower.includes("imply") || wordLower.includes("infer") || wordLower.includes("manifest")) return "fas fa-comment-dots";
            // İşaret, Çıkarım
            if (wordLower.includes("conclude") || wordLower.includes("result") || wordLower.includes("outcome") || wordLower.includes("find")) return "fas fa-check-circle";
            // Sonuç
            if (wordLower.includes("perceive") || wordLower.includes("observe") || wordLower.includes("account for") || wordLower.includes("reveal")) return "fas fa-eye";
            // Algılama, Gözlem
            if (wordLower.includes("apply") || wordLower.includes("implement") || wordLower.includes("utilize")) return "fas fa-cogs";
            // Uygulama, Kullanım
            if (wordLower.includes("reflect") || wordLower.includes("relate") || wordLower.includes("discuss")) return "fas fa-users";
            // İlişkilendirme, Tartışma
            if (wordLower.includes("validate") || wordLower.includes("corroborate")) return "fas fa-certificate";
            // Doğrulama, Onaylama
            if (wordLower.includes("generate") || wordLower.includes("create")) return "fas fa-lightbulb";
            // Üretme, Oluşturma
            if (wordLower.includes("evolve") || wordLower.includes("modify") || wordLower.includes("transform")) return "fas fa-dna";
            // Evrim, Dönüşüm
            if (wordLower.includes("comprise") || wordLower.includes("encompass") || wordLower.includes("contain")) return "fas fa-layer-group";
            // İçerme, Kapsama
            if (wordLower.includes("precede") || wordLower.includes("succeed")) return "fas fa-history";
            // Zaman/Sıra
            if (wordLower.includes("cite")) return "fas fa-quote-right";
            // Alıntı
            if (wordLower.includes("modify") || wordLower.includes("amend") || wordLower.includes("adjust")) return "fas fa-pen";
            // Değiştirme, Uyarlama
            if (wordLower.includes("replicate") || wordLower.includes("recur")) return "fas fa-redo-alt";
            // Tekrarlama
            if (wordLower.includes("signify") || wordLower.includes("denote")) return "fas fa-signature";
            // İfade etme, Anlamına gelme
            if (wordLower.includes("contribute")) return "fas fa-hands-helping";
            // Katkı
            if (wordLower.includes("hypothesize") || wordLower.includes("postulate") || wordLower.includes("presume") || wordLower.includes("predict")) return "fas fa-microscope";
            // Hipotez, Tahmin
            if (wordLower.includes("justify")) return "fas fa-balance-scale-right";
            // Gerekçelendirme
            if (wordLower.includes("envisage") || wordLower.includes("foresee")) return "fas fa-binoculars";
            // Öngörü
            if (wordLower.includes("hinder") || wordLower.includes("constrain") || wordLower.includes("inhibit") || wordLower.includes("restrict") || wordLower.includes("exclude")) return "fas fa-hand-paper";
            // Engelleme, Kısıtlama, Hariç tutma
            if (wordLower.includes("mitigate") || wordLower.includes("minimize") || wordLower.includes("alleviate")) return "fas fa-shield-alt";
            // Hafifletme, Koruma
            if (wordLower.includes("promote") || wordLower.includes("foster") || wordLower.includes("bolster")) return "fas fa-rocket";
            // Geliştirme, Destekleme
            if (wordLower.includes("acquire") || wordLower.includes("obtain") || wordLower.includes("attain")) return "fas fa-hand-holding";
            // Edinmek, Elde Etmek
            if (wordLower.includes("expend") || wordLower.includes("consume")) return "fas fa-wallet";
            // Harcama, Tüketim
            if (wordLower.includes("facilitate")) return "fas fa-unlock";
            // Kolaylaştırma
            if (wordLower.includes("fluctuate") || wordLower.includes("vary")) return "fas fa-chart-line";
            // Dalgalanma, Değişme
            if (wordLower.includes("guarantee") || wordLower.includes("ensure")) return "fas fa-award";
            // Garanti
            if (wordLower.includes("incur") || wordLower.includes("undergo")) return "fas fa-hospital";
            // Maruz kalma
            if (wordLower.includes("initiate") || wordLower.includes("start")) return "fas fa-play";
            // Başlatma
            if (wordLower.includes("innovate")) return "fas fa-magic";
            // Yenilik
            if (wordLower.includes("mediate") || wordLower.includes("liaise") || wordLower.includes("negotiate")) return "fas fa-people-arrows";
            // Arabuluculuk
            if (wordLower.includes("merge") || wordLower.includes("unify")) return "fas fa-compress-arrows-alt";
            // Birleştirme
            if (wordLower.includes("mandate") || wordLower.includes("legislate") || wordLower.includes("prescribe")) return "fas fa-scroll";
            // Emir, Yasa
            if (wordLower.includes("omit") || wordLower.includes("exclude")) return "fas fa-eraser";
            // Atlamak, Hariç tutmak
            if (wordLower.includes("oversee") || wordLower.includes("regulate")) return "fas fa-tools";
            // Denetleme, Düzenleme
            if (wordLower.includes("permit") || wordLower.includes("authorize")) return "fas fa-stamp";
            // İzin verme, Yetki
            if (wordLower.includes("prohibit")) return "fas fa-ban";
            // Yasaklama
            if (wordLower.includes("reconcile") || wordLower.includes("redress")) return "fas fa-handshake";
            // Uyumlaştırma, Telafi etme

            return "fas fa-cube"; // Default
        }

        function getExampleSentence(wordEn, wordTr) {
            // Örnek İngilizce cümleler
            const examplesEN = {
                "Analyze": "The research team must **analyze** the data carefully before concluding.",
                "Identify": "We need to **identify** the root causes of the problem.",
                "Determine": "The committee will **determine** the final grade based on performance.",
                "Formulate": "She helped to **formulate** a new strategy for the project.",
                "Acquire": "Students **acquire** new vocabulary through regular practice.",
                "Concept": "The main **concept** of the paper is highly debated.",
                "However": "The initial results were promising; **however**, more testing is required.",
                "Point out": "The professor **pointed out** the flaws in the methodology.",
                "Significantly": "The new treatment has **significantly** reduced the symptoms.",
                "Environment": "Protecting the natural **environment** is crucial for our future.",
            }; 
            
            // Örnek Türkçe cümleler
            const examplesTR = {
                "Analiz Etmek": "Araştırma ekibi, sonuca varmadan önce verileri dikkatlice analiz etmelidir.",
                "Tanımlamak, Belirlemek": "Sorunun temel nedenlerini belirlemeliyiz.",
                "Saptamak, Karar Vermek": "Komite, performansa göre son notu belirleyecek.",
                "Formüle Etmek, Geliştirmek": "Proje için yeni bir strateji formüle etmeye yardımcı oldu.",
                "Edinmek, Kazanmak": "Öğrenciler düzenli pratikle yeni kelimeler edinir.",
                "Kavram": "Makalenin ana kavramı yoğun bir şekilde tartışılmaktadır.",
                "Ancak, Yine de": "İlk sonuçlar umut vericiydi; ancak, daha fazla test gerekiyor.",
                "İşaret etmek, Belirtmek": "Profesör, metodolojideki kusurları işaret etti.",
                "Önemli ölçüde": "Yeni tedavi, semptomları önemli ölçüde azalttı.",
                "Çevre": "Doğal çevreyi korumak geleceğimiz için çok önemlidir.",
            }; 

            const defaultEn = `The study attempts to highlight how to properly use the term **${wordEn.toUpperCase()}** in academic writing.`;
            const defaultTr = `Çalışma, ${wordTr.toLowerCase()} teriminin akademik yazımda nasıl doğru kullanılacağını vurgulamaya çalışmaktadır.`;

            return {
                en: examplesEN[wordEn] || defaultEn,
                tr: examplesTR[wordTr] || defaultTr
            };
        }
        
        // === YARDIMCI VE QUIZ FONKSİYONLARI ===
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateQuiz(words, maxQuestions = 20) {
            const quiz = [];
            const shuffledWords = shuffleArray([...words]);
            const selectedWords = shuffledWords.slice(0, Math.min(maxQuestions, shuffledWords.length));
            
            selectedWords.forEach(word => {
                const question = word.en; // English word (Question prompt)
                const correctAnswer = word.tr; // Turkish translation (Correct answer)
                
                // 3 yanlış cevap (distractor) seç
                let distractors = shuffleArray(globalTranslationPool.filter(t => t !== correctAnswer))
                    .slice(0, 3);
                
                // Eğer distractors 3'ten azsa, kategorideki diğer kelimelerden rastgele seç
                if (distractors.length < 3) {
                    const allCategoryTranslations = words.map(w => w.tr).filter(t => t !== correctAnswer);
                    distractors = shuffleArray(allCategoryTranslations.filter(t => !distractors.includes(t))).slice(0, 3);
                }

                // Seçenekleri karıştır
                const options = shuffleArray([correctAnswer, ...distractors]);

                quiz.push({
                    question: question, 
                    correctAnswer: correctAnswer,
                    options: options
                });
            });
            return quiz;
        }

        function loadQuestion() {
            // Önceki sonuç ekranını temizle ve başlık alanını göster
            const existingResults = document.getElementById('quiz-results');
            if (existingResults) existingResults.remove();
            document.querySelector('.quiz-header-word').style.display = 'flex';

            if (currentQuestionIndex >= totalQuestions) {
                showResults();
                return;
            }

            const currentQuestion = currentQuiz[currentQuestionIndex];
            
            // DOM güncellemeleri
            document.getElementById('quiz-question-text').textContent = currentQuestion.question;
            document.getElementById('quiz-question-counter').textContent = `Soru ${currentQuestionIndex + 1} / ${totalQuestions}`;
            
            quizOptionsContainer.innerHTML = '';
            quizOptionsContainer.classList.remove('answered');

            currentQuestion.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option; // Seçenek metni (Türkçe çeviri)
                optionElement.onclick = () => checkAnswer(optionElement, option, currentQuestion.correctAnswer);
                quizOptionsContainer.appendChild(optionElement);
            });
        }

        function checkAnswer(selectedOption, selectedAnswer, correctAnswer) {
            quizOptionsContainer.classList.add('answered');
            if (selectedAnswer === correctAnswer) {
                selectedOption.classList.add('correct');
                score++;
            } else {
                selectedOption.classList.add('incorrect');
                // Doğru cevabı işaretle
                document.querySelectorAll('.quiz-option').forEach(option => {
                    if (option.textContent === correctAnswer) option.classList.add('correct');
                });
            }

            // Bir sonraki soruya geçmek için kısa bir gecikme
            currentQuestionIndex++;
            setTimeout(loadQuestion, 1500); // 1.5 saniye bekle
        }

        function showResults() {
            const percentage = totalQuestions > 0 ? ((score / totalQuestions) * 100).toFixed(0) : 0;
            let resultText = "Harika! Başarıyla tamamladın.";
            if (percentage < 50) resultText = "Daha fazla çalışmaya ihtiyacın var.";
            else if (percentage < 70) resultText = "İyi bir başlangıç! Biraz daha pratik yap.";

            const resultsHtml = `
                <div id="quiz-results" class="quiz-results"> 
                    <h2>Quiz Sonuçları</h2>
                    <p>${resultText}</p>
                    <div class="results-score-circle" style="background-color: ${percentage >= 70 ? 'var(--color-green)' : 'var(--color-red)'};">%${percentage}</div>
                    <p>Doğru: ${score}</p>
                    <p>Toplam Soru: ${totalQuestions}</p>
                    <button class="action-button btn-back-to-list" onclick="goBack()" style="margin-top: 20px;"><i class="fas fa-home"></i> Üniteye Geri Dön</button>
                </div>
            `;
            const quizPageContent = document.getElementById('quiz-page');
            document.querySelector('.quiz-header-word').style.display = 'none';
            quizPageContent.insertAdjacentHTML('beforeend', resultsHtml);
        }

        function startQuiz() {
            if (!currentUnitWords || currentUnitWords.length === 0) {
                alert('Quiz başlatılamadı. Lütfen önce bir ünite seçtiğinizden emin olun.');
                return;
            }
            // Quiz başlatma mantığı
            currentQuiz = generateQuiz(currentUnitWords);
            currentQuestionIndex = 0;
            score = 0;
            totalQuestions = currentQuiz.length;
            
            if (totalQuestions === 0) {
                alert('Quiz için yeterli kelime bulunamadı.');
                return;
            }

            navigateTo('quiz-page', 3, 'Quiz: ' + currentCategoryTitle);
            loadQuestion();
        }

        function getAllWordsFromCurrentCategory() {
            if (!currentCategoryTitle || !cardUnitData[currentCategoryTitle]) return [];
            return cardUnitData[currentCategoryTitle].flatMap(unit => unit.words);
        }

        function startSpecialQuiz(quizType) {
            const allWords = getAllWordsFromCurrentCategory();
            if (allWords.length === 0) { alert('Bu kategoride henüz kelime yok!'); return; } 
            
            let quizWords = [...allWords]; 
            let quizTitle = currentCategoryTitle; 
            let maxWords = 20;

            if (quizType === 'forgotten') {
                quizTitle += " - Unutulabilecek Kelimeler";
                // Şimdilik: Rastgele 20 kelime seçiliyor.
                quizWords = shuffleArray(quizWords).slice(0, Math.min(maxWords, quizWords.length));
            } else if (quizType === 'frequently_wrong') {
                quizTitle += " - Sık Yanlış Cevaplananlar";
                // Şimdilik: Rastgele 20 kelime seçiliyor.
                quizWords = shuffleArray(quizWords).slice(0, Math.min(maxWords, quizWords.length));
            } else if (quizType === 'mixed_review') {
                quizTitle += " - Karışık Tekrar Çalışması";
                // Şimdilik: Tüm kelimeler karıştırılıyor.
                quizWords = shuffleArray(quizWords);
            }

            // Quiz başlatma mantığı
            currentQuiz = generateQuiz(quizWords, maxWords);
            currentQuestionIndex = 0;
            score = 0; 
            totalQuestions = currentQuiz.length;

            if (totalQuestions === 0) {
                alert('Quiz için yeterli kelime bulunamadı.');
                return;
            }

            navigateTo('quiz-page', 2, quizTitle); // Seviye 2'de başlat
            loadQuestion();
        }


        // === UYGULAMA İLK YÜKLEME VE VERİ OLUŞTURMA ===

        function initApp() {
            const categories = Object.keys(realWordData);
            categories.forEach(category => {
                const unitsArray = Object.keys(realWordData[category]).map(unitNumStr => {
                    const unitNum = parseInt(unitNumStr);
                    const words = realWordData[category][unitNum];
                    
                    // Sahte öğrenilmiş kelime sayısını hesaplama (Simülasyon)
                    let learnedWords = 0;
                    if (unitNum === 1 && category === "İleri Düzey Akademik Fiiller") learnedWords = Math.min(words.length, 5);
                    else if (unitNum === 2 && category === "Akademik Fiiller") learnedWords = Math.min(words.length, 5);
                    else if (unitNum === 3 && category === "İleri Düzey Akademik Fiiller") learnedWords = Math.min(words.length, 5);
                    else if (unitNum <= 10) learnedWords = Math.min(words.length, Math.floor(words.length / 2)); 
                    else learnedWords = Math.min(words.length, Math.floor(words.length / 3));

                    // Ünite rengi
                    const colorClass = `u${unitNum % 20 === 0 ? 20 : unitNum % 20}`; 
                    
                    return { 
                        unit: unitNum, 
                        title: `Ünite ${unitNum}`, 
                        totalWords: words.length, 
                        learnedWords: learnedWords, 
                        words: words, // Kelime listesi
                        colorClass: colorClass 
                    };
                });
                cardUnitData[category] = unitsArray;
            });
            updateHomePageCards();
        }

        function updateHomePageCards() {
            document.querySelectorAll('#home-page .card').forEach(card => {
                const title = card.querySelector('h3').textContent;
                const info = cardUnitData[title];
                if (info) {
                    let totalWords = 0;
                    let totalLearned = 0;
                    info.forEach(unit => { 
                        totalWords += unit.totalWords; 
                        totalLearned += unit.learnedWords; 
                    });
                    const percentage = totalWords > 0 ? (totalLearned / totalWords) * 100 : 0;
                    const cardInfo = card.querySelector('.card-info');
                    cardInfo.querySelector('p').textContent = `${totalWords} kelimeden ${totalLearned} tanesi öğrenildi.`;
                    cardInfo.querySelector('.progress-fill').style.width = `${percentage.toFixed(0)}%`;
                }
            });
        }
        
        // === NAVİGASYON FONKSİYONLARI ===

        function navigateTo(targetPageId, level, title) {
            const currentPageId = document.querySelector('.page.active')?.id;
            
            // Eğer aynı sayfaya gidiliyorsa veya quiz sonuç sayfası gösteriliyorsa navigasyon yığınına ekleme/çıkarma yapma
            if (currentPageId !== targetPageId) {
                // Mevcut sayfanın state'ini kaydet
                if (currentPageId && currentPageId !== 'quiz-page' && !navigationStack.some(item => item.id === currentPageId)) {
                     // Quiz sayfasından geri gelindiğinde zaten stack'te olan sayfayı tekrar eklememek için kontrol
                    navigationStack.push({ id: currentPageId, title: headerTitle.textContent, level: backButton.dataset.pageLevel });
                }
            }


            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(targetPageId).classList.add('active');

            // Başlık ve geri butonu ayarları
            headerTitle.textContent = title;
            backButton.dataset.pageLevel = level;

            if (level === 0) {
                backButton.style.display = 'none';
                navigationStack = []; // Ana sayfada stack temizlenir
            } else {
                backButton.style.display = 'block';
            }
        }

        function goBack() {
            if (navigationStack.length > 0) {
                const prevPage = navigationStack.pop();
                
                // Eğer önceki sayfa Unit Detail ise ve mevcut sayfa Word Detail ise unit listesini yeniden yükle
                if (prevPage.id === 'unit-detail-page' && document.querySelector('.page.active').id === 'word-detail-page') {
                    // Kelime detayından ünite listesine dönerken ünite listesini yeniden yükle
                    const unitData = cardUnitData[currentCategoryTitle].find(u => u.unit === currentUnitNumber);
                    if (unitData) loadUnitWords(unitData, true); // true, sadece listeyi yenilemek için
                }

                // Eğer önceki sayfa Detail Page ise (Unit Listesi)
                if (prevPage.id === 'detail-page' && document.querySelector('.page.active').id === 'unit-detail-page') {
                    // Ünite detayından ana kategori listesine dönerken timeline'ı yeniden yükle
                    loadDetailPage(currentCategoryTitle);
                }

                navigateTo(prevPage.id, parseInt(prevPage.level), prevPage.title);
            } else {
                // Tüm stack boşsa ve ana sayfada değilsek ana sayfaya dön
                navigateTo('home-page', 0, 'EnglishBox Quiz App');
            }

            // Quiz sonuç ekranı varsa kaldır
            const existingResults = document.getElementById('quiz-results');
            if (existingResults) existingResults.remove();
        }

        backButton.addEventListener('click', goBack);

        // === SAYFA YÜKLEME FONKSİYONLARI ===

        function loadDetailPage(categoryTitle) {
            const units = cardUnitData[categoryTitle];
            if (!units) return;

            // Header'ı güncelle
            currentCategoryTitle = categoryTitle;

            // İstatistikleri hesapla ve güncelle
            let totalWords = 0;
            let totalLearned = 0;
            units.forEach(unit => { 
                totalWords += unit.totalWords; 
                totalLearned += unit.learnedWords; 
            });
            const correctRate = totalWords > 0 ? ((totalLearned / totalWords) * 100).toFixed(0) : 0;
            const learnedRate = correctRate; // Şimdilik ikisi aynı varsayılıyor
            
            document.getElementById('detail-correct-rate').textContent = `% ${correctRate}`;
            document.getElementById('detail-learned-rate').textContent = `% ${learnedRate}`;
            
            loadTimeline(units, categoryTitle);
            currentUnitNumber = null; // Kategoriye dönüldüğünde seçili üniteyi sıfırla
        }

        function loadTimeline(units, categoryTitle) {
            unitTimeline.innerHTML = '';
            units.forEach(unit => {
                const subtitleText = `${unit.learnedWords}/${unit.totalWords} kelime öğrenildi.`;
                const unitItem = document.createElement('div');
                unitItem.className = 'unit-item';
                unitItem.innerHTML = `
                    <div class="unit-circle ${unit.colorClass}">${unit.unit}</div>
                    <div class="unit-content">
                        <div class="unit-title">Ünite ${unit.unit}</div>
                        <div class="unit-subtitle"><span style="font-weight: normal; color: #888;">${subtitleText}</span></div>
                    </div>
                `;

                // Geri dönüldüğünde en son seçili üniteyi işaretle
                if (currentUnitNumber === unit.unit && currentCategoryTitle === categoryTitle) {
                    unitItem.classList.add('selected');
                }

                unitItem.addEventListener('click', () => {
                    currentUnitNumber = unit.unit;
                    loadUnitWords(unit);
                    navigateTo('unit-detail-page', 2, `${categoryTitle} - Ünite ${unit.unit}`);
                });
                unitTimeline.appendChild(unitItem);
            });
        }

        function loadUnitWords(unitData, refreshOnly = false) {
            currentUnitWords = unitData.words;

            if (!refreshOnly) {
                // Ünite Detay Bilgilerini güncelle
                const unitProgressCircle = document.getElementById('detail-unit-circle');
                unitProgressCircle.textContent = unitData.unit;
                unitProgressCircle.className = `unit-progress-circle ${unitData.colorClass}`;

                document.getElementById('detail-unit-progress').textContent = `${unitData.learnedWords}/${unitData.totalWords} Kelime Öğrenildi`;
            }


            wordListContainer.innerHTML = '';
            unitData.words.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.innerHTML = `
                    <div class="word-icon-placeholder">
                        <i class="${getWordIcon(word.en)}"></i>
                    </div>
                    <div class="word-text-group">
                        <div class="word-english">${word.en}</div>
                        <div class="word-turkish">${word.tr}</div>
                    </div>
                `;
                wordItem.addEventListener('click', () => {
                    loadWordDetail(word);
                    navigateTo('word-detail-page', 3, `${unitData.unit}. Ünite Kelime Detayı`);
                });
                wordListContainer.appendChild(wordItem);
            });
        }

        function loadWordDetail(word) {
            const sentences = getExampleSentence(word.en, word.tr);

            document.getElementById('word-icon-main').innerHTML = `<i class="${getWordIcon(word.en)}"></i>`;
            document.getElementById('detail-english-word').textContent = word.en;
            document.getElementById('detail-turkish-word').textContent = word.tr;
            document.getElementById('example-sentence-en').textContent = sentences.en;
            document.getElementById('example-sentence-tr').textContent = sentences.tr;
        }

        // Uygulamayı başlat
        initApp();
        navigateTo('home-page', 0, 'EnglishBox Quiz App');

        // Ana sayfa kartlarına olay dinleyicisi ekle
        cards.forEach(card => {
            const categoryTitle = card.querySelector('h3').textContent;
            const continueButton = card.querySelector('.btn-continue');
            const clickHandler = (e) => {
                if(e && e.stopPropagation) e.stopPropagation();
                currentCategoryTitle = categoryTitle;
                loadDetailPage(categoryTitle);
                navigateTo('detail-page', 1, categoryTitle);
            };
            // Kartın tüm alanına tıklama ekle
            card.addEventListener('click', clickHandler);
            // "DEVAM ET" butonuna tıklama ekle (gerekli değil, kart tıklaması yeterli, ama bırakılabilir)
            // continueButton.addEventListener('click', clickHandler); 
        });

    </script>
</body>
</html>
