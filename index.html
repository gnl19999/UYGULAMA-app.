<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnglishBox Quiz App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* GENEL AYARLAR */
        :root {
            --bg-light-gray: #f2f2f7;
            --color-primary: #3498db;
            --color-dark: #333;
            --color-light-gray: #eee;
            --color-yellow: #f1c40f;
            --color-red: #e74c3c;
            --color-green: #a3cb38;
            --color-icon-bg: #ecf0f1;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-light-gray);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .mobile-container {
            width: 100%;
            max-width: 400px;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            min-height: 700px; 
            padding-bottom: 0;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 15px 20px;
            background-color: #fff;
            border-bottom: 1px solid var(--color-light-gray);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .header-content { display: flex; align-items: center; width: 100%; }
        header h1 { font-size: 18px; font-weight: bold; margin-left: 0; flex-grow: 1; } 
        .back-button { color: var(--color-dark); cursor: pointer; font-size: 18px; background: none;
            border: none; padding: 0; line-height: 1; margin-right: 15px; }

        /* SAYFA YAPISI */
        .page { display: none; opacity: 0; transition: opacity 0.3s ease; width: 100%; }
        .page.active { display: block; opacity: 1; }
        
        #unit-detail-page.active, #word-detail-page.active {
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
            padding-bottom: 90px; /* Buton payı */
        }
        
        /* KART STİLLERİ */
        .card {
            background: #fff;
            margin: 15px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid var(--color-light-gray);
            overflow: hidden; cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .card:active { transform: scale(0.99); }
        .card:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .card-content { padding: 15px; display: flex; align-items: center; }
        .card-icon-wrapper {
            width: 60px; height: 60px; border-radius: 50%; margin-right: 15px;
            display: flex; align-items: center; justify-content: center; color: #fff; font-size: 24px; flex-shrink: 0;
        }
        .icon-verb { background-color: #34495e; }
        .icon-noun { background-color: #e91e63; }
        .icon-adj { background-color: var(--color-green); }
        .icon-adv { background-color: #e67e22; }
        .icon-conj { background-color: #9b59b6; }
        .icon-phrasal { background-color: var(--color-primary); }
        
        .card-info { flex-grow: 1; }
        .card-info h3 { font-size: 16px; margin-bottom: 5px; color: var(--color-dark); }
        .card-info p { font-size: 13px; color: #888; margin-bottom: 8px; }
        .progress-bar { height: 6px; background-color: var(--color-light-gray); border-radius: 3px; width: 100%; }
        .progress-fill { height: 100%; background-color: var(--color-primary); width: 0%; border-radius: 3px; transition: width 0.5s ease; } 
        
        .btn-continue {
            width: 100%; padding: 12px; background: #fff; border: none;
            border-top: 1px solid var(--color-light-gray); color: var(--color-dark);
            font-weight: bold; font-size: 14px; cursor: pointer; text-transform: uppercase;
            transition: background 0.2s, color 0.2s;
        }
        .btn-continue:hover { background-color: #f5f5f5; }

        /* DETAY SAYFASI */
        .stats-row { display: flex; justify-content: space-around; padding: 20px 10px; background: #fff; margin-bottom: 10px; }
        .stat-item { display: flex; flex-direction: column; align-items: center; text-align: center; width: 30%; cursor: pointer; padding: 5px; }
        .stat-icon-circle { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 20px; margin-bottom: 8px; }
        .stat-text { font-size: 11px; color: #666; line-height: 1.2; }
        .bg-yellow { background-color: var(--color-yellow); }
        .bg-red { background-color: var(--color-red); }
        .bg-green { background-color: var(--color-green); }
        
        .percentage-row { display: flex; justify-content: space-between; padding: 10px 20px; background: #fff;
            font-weight: bold; font-size: 14px; margin-bottom: 20px; border-top: 1px solid var(--color-light-gray); border-bottom: 1px solid var(--color-light-gray);
        }
        .percentage-row .percentage-value { color: #f39c12; }
        .percentage-row .label { font-weight: normal; color: #666; font-size: 12px; }

        /* Timeline / Ünite Listesi */
        .timeline { padding: 0 20px; padding-bottom: 20px; }
        .unit-item {
            display: flex; align-items: center; position: relative; padding: 15px 10px;
            cursor: pointer; transition: background-color 0.2s; border-radius: 8px;
            margin-bottom: 8px; background-color: #fff; border: 1px solid var(--color-light-gray);
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .unit-item.selected { background-color: #f0f8ff; border: 1px solid #cceeff; }
        .unit-item:hover { background-color: #f9f9f9; }

        .unit-circle { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: #fff; font-weight: bold; flex-shrink: 0; z-index: 2; }
        .unit-content { margin-left: 15px; }
        .unit-title { font-weight: bold; color: var(--color-dark); font-size: 16px; }
        .unit-subtitle { font-size: 13px; color: #999; margin-top: 4px; }
        
        .u1, .u6, .u11, .u16 { background-color: #e91e63; }
        .u2, .u7, .u12, .u17 { background-color: var(--color-primary); }
        .u3, .u8, .u13, .u18 { background-color: #000; }
        .u4, .u9, .u14, .u19 { background-color: var(--color-green); }
        .u5, .u10, .u15, .u20 { background-color: #e67e22; }

        /* ÜNİTE DETAY & KELİME LİSTESİ */
        .unit-detail-info { padding: 20px; text-align: center; flex-shrink: 0; }
        .unit-progress-circle { width: 120px; height: 120px; border-radius: 50%;
            background-color: var(--color-primary); color: #fff; font-size: 36px; font-weight: bold; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px auto;
        }
        .unit-detail-info p { font-size: 14px; color: #888; margin-bottom: 10px; height: 18px; }
        .unit-detail-info .word-count-info { font-size: 16px; font-weight: bold; color: var(--color-dark); margin-top: 10px; }
        
        /* Buton Sabitleme */
        .bottom-actions { 
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 400px; background-color: #fff; padding: 15px 20px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1); z-index: 100;
            display: flex; flex-direction: column; gap: 10px; flex-shrink: 0;
        }
        .action-button { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px;
            font-weight: bold; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin: 0;
        }
        .btn-quiz { background-color: var(--color-green); }
        .btn-back-to-list { background-color: var(--color-primary); } 

        .unit-word-list { padding: 0 15px 10px 15px; overflow-y: auto; flex-grow: 1; }
        
        /* Kelime Listesi İKON STİLİ */
        .word-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--color-light-gray); cursor: pointer; } 
        .word-item:last-child { border-bottom: none; }
        
        .word-icon-placeholder {
            width: 50px; height: 50px; border-radius: 8px; margin-right: 15px;
            display: flex; align-items: center; justify-content: center;
            background-color: var(--color-icon-bg); color: var(--color-primary);
            font-size: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); flex-shrink: 0;
        }
        
        .word-text-group { display: flex; flex-direction: column; }
        .word-english { font-weight: bold; color: var(--color-dark); font-size: 16px; text-transform: lowercase; }
        .word-turkish { font-size: 14px; color: #888; text-transform: lowercase; }

        /* QUIZ SAYFASI STİLLERİ */
        #quiz-page { display: flex; flex-direction: column; padding: 0 20px; text-align: center; padding-bottom: 20px; }
        .quiz-header-word { padding: 30px 0; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
        .quiz-speaker-icon { font-size: 36px; color: var(--color-yellow); margin-bottom: 10px; cursor: pointer; }
        #quiz-question-text { font-size: 32px; color: var(--color-dark); font-weight: bold; margin: 0; text-transform: capitalize; }
        #quiz-question-counter { font-size: 14px; color: #999; margin-top: 10px; font-weight: normal; }
        .options-container { display: flex; flex-direction: column; gap: 15px; }
        .quiz-option { padding: 20px 15px; background-color: #fff; border: 1px solid var(--color-light-gray);
            border-radius: 12px; text-align: center; font-weight: bold; font-size: 16px; color: var(--color-dark);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.1s; text-transform: lowercase;
        }
        .quiz-option.correct { background-color: var(--color-green); color: white; border-color: var(--color-green); pointer-events: none; animation: pulse-correct 0.5s ease; }
        .quiz-option.incorrect { background-color: var(--color-red); color: white; border-color: var(--color-red); pointer-events: none; animation: shake-incorrect 0.3s ease; }
        .options-container.answered .quiz-option:not(.correct):not(.incorrect) { opacity: 0.5; pointer-events: none; }
        .quiz-results { margin-top: 50px; padding: 20px; background-color: var(--bg-light-gray); border-radius: 15px; text-align: center; }
        .results-score-circle { width: 100px; height: 100px; border-radius: 50%; background-color: var(--color-green);
            color: white; font-size: 28px; font-weight: bold; display: flex; align-items: center; justify-content: center; margin: 20px auto;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }

        /* YENİ KELİME DETAY SAYFASI STİLLERİ */
        .word-detail-content { padding: 20px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; padding-bottom: 20px;}
        #word-icon-main {
            width: 150px; height: 150px; border-radius: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); background-color: var(--color-icon-bg);
            color: var(--color-primary); display: flex; align-items: center; justify-content: center; font-size: 70px;
        }
        .word-main-info { text-align: center; margin-bottom: 20px; }
        #detail-english-word { font-size: 30px; font-weight: bold; color: var(--color-dark); text-transform: capitalize; display: inline-block; margin-right: 10px; }
        #detail-turkish-word { font-size: 18px; color: var(--color-primary); font-weight: 500; display: block; margin-top: 5px; text-transform: capitalize; }
        
        .example-sentences-container { 
            padding: 15px 20px; width: 100%; text-align: left; margin-bottom: 20px;
            border-top: 1px solid var(--color-light-gray); border-bottom: 1px solid var(--color-light-gray);
        }
        .example-sentence-en { 
            font-style: italic; font-size: 16px; line-height: 1.5; color: var(--color-dark);
            margin-bottom: 8px; background-color: var(--bg-light-gray); padding: 10px; border-radius: 8px;
        }
        .example-sentence-tr { 
            font-size: 14px; line-height: 1.5; color: #888; padding: 5px 10px;
            border-left: 3px solid var(--color-primary); margin-top: 10px;
        }
        .speaker-icon-small { color: var(--color-dark); cursor: pointer; font-size: 20px; margin-left: 10px; }

        @keyframes pulse-correct { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes shake-incorrect { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

    </style>
</head>
<body>

    <div class="mobile-container">
        
        <header>
            <div class="header-content">
                <button id="back-button" class="back-button" style="display: none;" data-page-level="1">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>EnglishBox</h1> 
            </div>
        </header>

        <div id="home-page" class="page active">
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-verb"><i class="fas fa-book-open"></i></div><div class="card-info"><h3>İleri Düzey Akademik Fiiller</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="İleri Düzey Akademik Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-verb"><i class="fas fa-running"></i></div><div class="card-info"><h3>Akademik Fiiller</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-adj"><i class="fas fa-star"></i></div><div class="card-info"><h3>Akademik Sıfatlar</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Sıfatlar">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-noun"><i class="fas fa-building"></i></div><div class="card-info"><h3>Akademik İsimler</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik İsimler">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-conj"><i class="fas fa-link"></i></div><div class="card-info"><h3>Akademik Bağlaçlar</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Bağlaçlar">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-phrasal"><i class="fas fa-dice"></i></div><div class="card-info"><h3>Öbek Fiiller</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Öbek Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-adv"><i class="fas fa-clock"></i></div><div class="card-info"><h3>Akademik Zarflar</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Zarflar">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-noun"><i class="fas fa-users"></i></div><div class="card-info"><h3>En Çok Kullanılan İsimler</h3><p>Yükleniyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="En Çok Kullanılan İsimler">DEVAM ET</button></div>
        </div>

        <div id="detail-page" class="page">
            <div class="stats-row">
                 <div class="stat-item" onclick="alert('Unutulabilecek Kelimeler çalışması yakında!')"><div class="stat-icon-circle bg-yellow"><i class="fas fa-thumbtack"></i></div><div class="stat-text">Unutulabilecek<br>Kelimeler</div></div>
                <div class="stat-item" onclick="alert('Sık Yanlış Cevaplananlar yakında!')"><div class="stat-icon-circle bg-red"><i class="fas fa-times"></i></div><div class="stat-text">Sık Yanlış<br>Cevaplananlar</div></div>
                <div class="stat-item" onclick="alert('Karışık Tekrar Çalışması yakında!')"><div class="stat-icon-circle bg-green"><i class="fas fa-random"></i></div><div class="stat-text">Karışık Tekrar<br>Çalışması</div></div>
            </div>
            
            <div class="percentage-row">
                <div class="percentage-item"><span class="percentage-value" id="detail-correct-rate">% 0</span> <span class="label">Doğru yanıtlar</span></div>
                <div class="percentage-item"><span class="percentage-value" id="detail-learned-rate">% 0</span> <span class="label">Öğrenilenlerin oranı</span></div>
            </div>
            
            <div class="timeline"></div>
        </div>

        <div id="unit-detail-page" class="page">
            <div class="unit-detail-info">
                <div class="unit-progress-circle" id="detail-unit-circle">1</div>
                <p id="detail-unit-progress" class="word-count-info"></p>
            </div>
             <div class="unit-word-list" id="word-list-container"></div>
            <div class="bottom-actions">
                <button class="action-button btn-quiz" onclick="startQuiz()">
                    <i class="fas fa-question-circle"></i> Quiz Çöz
                </button>
            </div>
        </div>
        
        <div id="word-detail-page" class="page">
            <div class="word-detail-content">
                <div id="word-icon-main"><i class="fas fa-cube"></i></div>
                <div class="word-main-info">
                    <span id="detail-english-word"></span>
                    <i class="fas fa-volume-up speaker-icon-small" onclick="alert('Seslendirildi!')"></i>
                    <span id="detail-turkish-word"></span>
                </div>
                
                <div class="example-sentences-container">
                    <p id="example-sentence-en" class="example-sentence-en"></p>
                    <p id="example-sentence-tr" class="example-sentence-tr"></p>
                </div>
            </div>
            <div class="bottom-actions">
                <button class="action-button btn-back-to-list" onclick="goBack()">
                    <i class="fas fa-list-ul"></i> Kelime Listesine Dön
                </button>
            </div>
        </div>

        <div id="quiz-page" class="page">
            <div class="quiz-header-word">
                <i class="fas fa-volume-up quiz-speaker-icon" onclick="alert('Seslendirildi!')"></i>
                <h3 id="quiz-question-text">WORD</h3>
                 <p id="quiz-question-counter"></p>
            </div>
            <div id="quiz-options" class="options-container">
            </div>
        </div>

    </div>

    <script>
        // === YENİ VERİ YAPISI VE KELİME HAVUZLARI ===

        // Kategori Listesi
        const categories = [
            "İleri Düzey Akademik Fiiller",
            "Akademik Fiiller",
            "Akademik Sıfatlar",
            "Akademik İsimler",
            "Akademik Bağlaçlar",
            "Öbek Fiiller",
            "Akademik Zarflar",
            "En Çok Kullanılan İsimler",
        ];

        // Kelime Havuzları
        const İleri Düzey Akademik Fiiller = [
            { en: "articulate", tr: "açıkça ifade etmek" }, { en: "conceptualize", tr: "kavramsallaştırmak" }, { en: "underscore", tr: "vurgulamak" }, { en: "juxtapose", tr: "yan yana koymak" }, { en: "epitomize", tr: "özetlemek" },
            { en: "disseminate", tr: "yaymak" }, { en: "ameliorate", tr: "iyileştirmek" }, { en: "confer", tr: "görüşmek, vermek" }, { en: "elucidate", tr: "açıklığa kavuşturmak" }, { en: "substantiate", tr: "doğrulamak" },
            { en: "demarcate", tr: "sınırlandırmak" }, { en: "mitigate", tr: "hafifletmek" }, { en: "perpetuate", tr: "sürdürmek" }, { en: "recapitulate", tr: "özetlemek" }, { en: "stipulate", tr: "şart koşmak" },
            { en: "transcend", tr: "aşmak" }, { en: "validate", tr: "onaylamak" }, { en: "synthesize", tr: "sentezlemek" }, { en: "scrutinize", tr: "incelemek" }, { en: "presuppose", tr: "varsaymak" },
            { en: "scrutinize", tr: "incelemek" }, { en: "presuppose", tr: "varsaymak" },
        	{ "en": "Analyze", "tr": "Analiz Etmek" },
	{ "en": "Identify", "tr": "Tanımlamak, Belirlemek" },
	{ "en": "Determine", "tr": "Saptamak, Karar Vermek" },
	{ "en": "Establish", "tr": "Kurmak, Oluşturmak, Saptamak" },
	{ "en": "Investigate", "tr": "Araştırmak, İncelemek" },
	{ "en": "Illustrate", "tr": "Örneklemek, Açıklamak" },
	{ "en": "Demonstrate", "tr": "Göstermek, Kanıtlamak" },
	{ "en": "Evaluate", "tr": "Değerlendirmek" },
	{ "en": "Synthesize", "tr": "Sentezlemek" },.	
    { "en": "Formulate", "tr": "Formüle Etmek, Geliştirmek" },
	{ "en": "Define", "tr": "Tanımlamak" },
	{ "en": "Compare", "tr": "Karşılaştırmak" },
	{ "en": "Contrast", "tr": "Karşıtlık Kurmak, Farklılıkları Belirtmek" },
	{ "en": "Argue", "tr": "Tartışmak, İddia Etmek" },
	{ "en": "Support", "tr": "Desteklemek" },
	{ "en": "Challenge", "tr": "Sorgulamak, Meydan Okumak" },
	{ "en": "Derive", "tr": "Türetmek, Elde Etmek" },
	{ "en": "Indicate", "tr": "İşaret Etmek, Göstermek" },
	{ "en": "Suggest", "tr": "Öne Sürmek, Önermek" },
	{ "en": "Conclude", "tr": "Sonuçlandırmak" },

            // Ünite 2
            { en: "expound", tr: "detaylı açıklamak" }, { en: "delineate", tr: "tasvir etmek" }, { en: "extrapolate", tr: "tahmin etmek (bilinenden)" }, { en: "hinder", tr: "engellemek" }, { en: "inculcate", tr: "aşılamak" },
            { en: "reify", tr: "somutlaştırmak" }, { en: "adduce", tr: "kanıt göstermek" }, { en: "coalesce", tr: "birleşmek" }, { en: "debunk", tr: "çürütmek" }, { en: "engender", tr: "yol açmak" },
            { en: "falsify", tr: "yanlışlığını göstermek" }, { en: "germinate", tr: "filizlenmek" }, { en: "intertwine", tr: "iç içe geçmek" }, { en: "mandate", tr: "yetki vermek" }, { en: "ostracize", tr: "dışlamak" },
            { en: "promulgate", tr: "ilan etmek" }, { en: "quell", tr: "bastırmak" }, { en: "rebut", tr: "aksi kanıtlamak" }, { en: "truncate", tr: "kısaltmak" }, { en: "venerate", tr: "saygı göstermek" },
            // Diğer 360 kelime placeholder olarak kalacak.
            // advancedVerbsList'i 400 kelimeye tamamlayalım.
            ...Array.from({ length: 360 }, (_, i) => ({
                en: `[ADVANCED VERB ${i + 41}]`,
                tr: `[ADVANCED FİİL TR ${i + 41}]`
            }))
        ];

        const academicVerbsList = [
            // Unit 1
            { en: "acquire", tr: "edinmek" }, { en: "adjust", tr: "ayarlamak" }, { en: "allocate", tr: "tahsis etmek" }, { en: "analyze", tr: "analiz etmek" }, { en: "approximate", tr: "yaklaşmak" },
            { en: "assert", tr: "iddia etmek" }, { en: "assume", tr: "varsaymak" }, { en: "comprise", tr: "oluşmak" }, { en: "confine", tr: "sınırlandırmak" }, { en: "constitute", tr: "oluşturmak" },
            // Unit 2
            { en: "contend", tr: "çekişmek, iddia etmek" }, { en: "deduce", tr: "sonuç çıkarmak" }, { en: "demonstrate", tr: "göstermek" }, { en: "derive", tr: "türetmek" }, { en: "devise", tr: "tasarlamak" },
            { en: "displace", tr: "yerinden etmek" }, { en: "document", tr: "belgelemek" }, { en: "edit", tr: "düzenlemek" }, { en: "enhance", tr: "geliştirmek" }, { en: "establish", tr: "kurmak" },
            // ...Diğer 18 ünite için placeholder
            ...Array.from({ length: 180 }, (_, i) => ({ en: `[ACADEMIC VERB ${i + 21}]`, tr: `[ACADEMIC FİİL TR ${i + 21}]` }))
        ];

        const academicAdjectivesList = [
            // Unit 1
            { en: "accurate", tr: "doğru, kesin" }, { en: "adequate", tr: "yeterli" }, { en: "arbitrary", tr: "keyfi" }, { en: "coherent", tr: "tutarlı" }, { en: "commensurate", tr: "oranlı, uygun" },
            { en: "comprehensive", tr: "kapsamlı" }, { en: "crucial", tr: "çok önemli" }, { en: "distinct", tr: "farklı, belirgin" }, { en: "diverse", tr: "çeşitli" }, { en: "empirical", tr: "deneysel" },
            // Unit 2
            { en: "explicit", tr: "açık, belirgin" }, { en: "feasible", tr: "olası, yapılabilir" }, { en: "implicit", tr: "örtük, dolaylı" }, { en: "inherent", tr: "doğal, içsel" }, { en: "integral", tr: "bütünleyici" },
            { en: "legitimate", tr: "meşru" }, { en: "marginal", tr: "önemsiz" }, { en: "paradoxical", tr: "çelişkili" }, { en: "predominant", tr: "baskın" }, { en: "qualitative", tr: "nitel" },
            // ...Diğer 18 ünite için placeholder
            ...Array.from({ length: 180 }, (_, i) => ({ en: `[ACADEMIC ADJ ${i + 21}]`, tr: `[ACADEMIC SIFAT TR ${i + 21}]` }))
        ];

        const academicNounsList = [
            // Unit 1
            { en: "analysis", tr: "analiz" }, { en: "approach", tr: "yaklaşım" }, { en: "area", tr: "alan" }, { en: "assessment", tr: "değerlendirme" }, { en: "assumption", tr: "varsayım" },
            { en: "authority", tr: "otorite" }, { en: "benefit", tr: "fayda" }, { en: "concept", tr: "kavram" }, { en: "context", tr: "bağlam" }, { en: "data", tr: "veri" },
            // Unit 2
            { en: "distribution", tr: "dağıtım" }, { en: "economy", tr: "ekonomi" }, { en: "environment", tr: "çevre" }, { en: "evidence", tr: "kanıt" }, { en: "factor", tr: "faktör" },
            { en: "formula", tr: "formül" }, { en: "function", tr: "işlev" }, { en: "identity", tr: "kimlik" }, { en: "impact", tr: "etki" }, { en: "issue", tr: "mesele" },
            // ...Diğer 18 ünite için placeholder
            ...Array.from({ length: 180 }, (_, i) => ({ en: `[ACADEMIC NOUN ${i + 21}]`, tr: `[ACADEMIC İSİM TR ${i + 21}]` }))
        ];

        const academicConjunctionsList = [
            // Unit 1
            { en: "although", tr: "rağmen" }, { en: "conversely", tr: "tersine" }, { en: "consequently", tr: "sonuç olarak" }, { en: "furthermore", tr: "ayrıca" }, { en: "hence", tr: "bu nedenle" },
            { en: "however", tr: "ancak" }, { en: "in addition", tr: "ek olarak" }, { en: "in contrast", tr: "aksine" }, { en: "in summary", tr: "özetle" }, { en: "moreover", tr: "üstelik" },
            // Unit 2
            { en: "nevertheless", tr: "yine de" }, { en: "nonetheless", tr: "buna rağmen" }, { en: "on the contrary", tr: "tam tersine" }, { en: "on the other hand", tr: "öte yandan" }, { en: "similarly", tr: "benzer şekilde" },
            { en: "subsequently", tr: "daha sonra" }, { en: "therefore", tr: "bu yüzden" }, { en: "thus", tr: "böylece" }, { en: "whereas", tr: "oysa" }, { en: "while", tr: "iken" },
            // ...Diğer 18 ünite için placeholder
            ...Array.from({ length: 180 }, (_, i) => ({ en: `[ACADEMIC CONJ ${i + 21}]`, tr: `[ACADEMIC BAĞLAÇ TR ${i + 21}]` }))
        ];

        const phrasalVerbsList = [
            // Unit 1
            { en: "account for", tr: "açıklamak" }, { en: "call for", tr: "gerektirmek" }, { en: "carry out", tr: "gerçekleştirmek" }, { en: "come up with", tr: "ortaya çıkarmak" }, { en: "deal with", tr: "ele almak" },
            { en: "do away with", tr: "kaldırmak" }, { en: "figure out", tr: "anlamak, çözmek" }, { en: "find out", tr: "öğrenmek" }, { en: "get over", tr: "atlatmak" }, { en: "look into", tr: "incelemek" },
            // Unit 2
            { en: "make up for", tr: "telafi etmek" }, { en: "point out", tr: "işaret etmek" }, { en: "put forward", tr: "öne sürmek" }, { en: "refer to", tr: "atıfta bulunmak" }, { en: "set up", tr: "kurmak" },
            { en: "take into account", tr: "dikkate almak" }, { en: "take over", tr: "devralmak" }, { en: "turn out", tr: "sonuçlanmak" }, { en: "wind up", tr: "bitirmek" }, { en: "work out", tr: "çözmek, hesaplamak" },
            // ...Diğer 18 ünite için placeholder
            ...Array.from({ length: 180 }, (_, i) => ({ en: `[PHRASAL VERB ${i + 21}]`, tr: `[ÖBEK FİİL TR ${i + 21}]` }))
        ];

        const academicAdverbsList = [
            // Unit 1
            { en: "accordingly", tr: "buna göre" }, { en: "consequently", tr: "sonuç olarak" }, { en: "crucially", tr: "çok önemli olarak" }, { en: "evidently", tr: "açıkça" }, { en: "explicitly", tr: "açıkça, sarih bir şekilde" },
            { en: "fundamentally", tr: "temelde" }, { en: "implicitly", tr: "dolaylı olarak" }, { en: "invariably", tr: "her zaman, değişmez bir şekilde" }, { en: "legitimately", tr: "meşru bir şekilde" }, { en: "marginally", tr: "önemsiz ölçüde" },
            // Unit 2
            { en: "notably", tr: "özellikle" }, { en: "ostensibly", tr: "görünüşte" }, { en: "potentially", tr: "potansiyel olarak" }, { en: "primarily", tr: "öncelikle" }, { en: "qualitatively", tr: "nitel olarak" },
            { en: "quantitatively", tr: "nicel olarak" }, { en: "significantly", tr: "önemli ölçüde" }, { en: "subsequently", tr: "sonradan" }, { en: "tentatively", tr: "geçici olarak" }, { en: "ultimately", tr: "nihayetinde" },
            // ...Diğer 18 ünite için placeholder
            ...Array.from({ length: 180 }, (_, i) => ({ en: `[ACADEMIC ADV ${i + 21}]`, tr: `[ACADEMIC ZARF TR ${i + 21}]` }))
        ];

        const frequentlyUsedNounsList = [
            // Unit 1
            { en: "people", tr: "insanlar" }, { en: "history", tr: "tarih" }, { en: "way", tr: "yol" }, { en: "art", tr: "sanat" }, { en: "world", tr: "dünya" },
            { en: "information", tr: "bilgi" }, { en: "map", tr: "harita" }, { en: "family", tr: "aile" }, { en: "government", tr: "hükümet" }, { en: "health", tr: "sağlık" },
            // Unit 2
            { en: "system", tr: "sistem" }, { en: "computer", tr: "bilgisayar" }, { en: "meat", tr: "et" }, { en: "year", tr: "yıl" }, { en: "thanks", tr: "teşekkürler" },
            { en: "music", tr: "müzik" }, { en: "person", tr: "kişi" }, { en: "reading", tr: "okuma" }, { en: "method", tr: "yöntem" }, { en: "data", tr: "veri" },
            // ...Diğer 18 ünite için placeholder
            ...Array.from({ length: 180 }, (_, i) => ({ en: `[COMMON NOUN ${i + 21}]`, tr: `[ORTAK İSİM TR ${i + 21}]` }))
        ];


        // Ham veriyi oluştur
        const realWordData = categories.reduce((acc, category) => {
            acc[category] = {};
            let wordList;
            let wordsPerUnit;

            switch (category) {
                case "İleri Düzey Akademik Fiiller":
                    wordList = advancedVerbsList;
                    wordsPerUnit = 20; // 400/20
                    break;
                case "Akademik Fiiller":
                    wordList = academicVerbsList;
                    wordsPerUnit = 10; // 200/20
                    break;
                case "Akademik Sıfatlar":
                    wordList = academicAdjectivesList;
                    wordsPerUnit = 10; // 200/20
                    break;
                case "Akademik İsimler":
                    wordList = academicNounsList;
                    wordsPerUnit = 10; // 200/20
                    break;
                case "Akademik Bağlaçlar":
                    wordList = academicConjunctionsList;
                    wordsPerUnit = 10; // 200/20
                    break;
                case "Öbek Fiiller":
                    wordList = phrasalVerbsList;
                    wordsPerUnit = 10; // 200/20
                    break;
                case "Akademik Zarflar":
                    wordList = academicAdverbsList;
                    wordsPerUnit = 10; // 200/20
                    break;
                case "En Çok Kullanılan İsimler":
                    wordList = frequentlyUsedNounsList;
                    wordsPerUnit = 10; // 200/20
                    break;
                default:
                    wordList = [];
                    wordsPerUnit = 10;
                    break;
            }

            for (let i = 1; i <= 20; i++) {
                const startIndex = (i - 1) * wordsPerUnit;
                acc[category][i] = wordList.slice(startIndex, startIndex + wordsPerUnit);
            }
            return acc;
        }, {});

        // === GELİŞMİŞ OTOMATİK CÜMLE OLUŞTURUCU (ŞABLON SİSTEMİ) ===
        // Bu sistem, kelimenin kategorisine göre farklı ve mantıklı şablonlar seçer.
        
        const sentenceTemplates = {
            'verb': [
                { en: "The primary objective of this study is to [WORD] the underlying causes.", tr: "Bu çalışmanın birincil amacı, temel nedenleri [TR_WORD]." },
                { en: "Researchers must [WORD] the data carefully before drawing conclusions.", tr: "Araştırmacılar sonuç çıkarmadan önce verileri dikkatlice [TR_WORD]." },
                { en: "This theory attempts to [WORD] the relationship between the two variables.", tr: "Bu teori, iki değişken arasındaki ilişkiyi [TR_WORD] çalışır." },
                { en: "It is crucial to [WORD] appropriate methods for accurate results.", tr: "Doğru sonuçlar için uygun yöntemleri [TR_WORD] çok önemlidir." }
            ],
            'noun': [
                { en: "The [WORD] provides significant insight into the problem.", tr: "[TR_WORD], soruna dair önemli bir içgörü sağlar." },
                { en: "There is a direct correlation between the [WORD] and the outcome.", tr: "[TR_WORD] ile sonuç arasında doğrudan bir korelasyon vardır." },
                { en: "Understanding the [WORD] is essential for future research.", tr: "Gelecekteki araştırmalar için [TR_WORD] anlamak esastır." },
                { en: "The concept of [WORD] has been widely debated in literature.", tr: "[TR_WORD] kavramı literatürde geniş çapta tartışılmıştır." }
            ],
            'adj': [
                { en: "The results of the experiment were [WORD] and unexpected.", tr: "Deneyin sonuçları [TR_WORD] ve beklenmedik idi." },
                { en: "It is [WORD] to consider all possible factors.", tr: "Tüm olası faktörleri göz önünde bulundurmak [TR_WORD]." },
                { en: "This approach offers a [WORD] solution to the crisis.", tr: "Bu yaklaşım, krize [TR_WORD] bir çözüm sunar." },
                { en: "Such [WORD] evidence cannot be ignored.", tr: "Böylesine [TR_WORD] bir kanıt göz ardı edilemez." }
            ],
            'adv': [
                { en: "The population has increased [WORD] over the last decade.", tr: "Nüfus son on yılda [TR_WORD] arttı." },
                { en: "This phenomenon is [WORD] observed in nature.", tr: "Bu fenomen doğada [TR_WORD] gözlemlenir." },
                { en: "The data was [WORD] analyzed by the team.", tr: "Veriler ekip tarafından [TR_WORD] analiz edildi." }
            ],
            'conj': [
                { en: "[WORD], the results suggest a need for further investigation.", tr: "[TR_WORD], sonuçlar daha fazla araştırmaya ihtiyaç olduğunu gösteriyor." },
                { en: "The project was ambitious, [WORD] it lacked funding.", tr: "Proje iddialıydı, [TR_WORD] finansmandan yoksundu." }
            ],
            'general': [
                { en: "The term '[WORD]' is frequently used in this context.", tr: "'[TR_WORD]' terimi bu bağlamda sıklıkla kullanılır." },
                { en: "We need to focus on the concept of [WORD].", tr: "[TR_WORD] kavramına odaklanmamız gerekiyor." }
            ]
        };

        function getCategoryType(categoryTitle) {
            if (categoryTitle.includes("Fiil") || categoryTitle.includes("Verb")) return 'verb';
            if (categoryTitle.includes("İsim") || categoryTitle.includes("Noun")) return 'noun';
            if (categoryTitle.includes("Sıfat") || categoryTitle.includes("Adjective")) return 'adj';
            if (categoryTitle.includes("Zarf") || categoryTitle.includes("Adverb")) return 'adv';
            if (categoryTitle.includes("Bağlaç")) return 'conj';
            return 'general';
        }

        function generateSmartSentence(wordEN, wordTR, categoryTitle) {
            // Eğer kelime placeholder ise (köşeli parantezliyse)
            if (wordEN.startsWith("[")) {
                return {
                    en: "Example sentence will appear here when you add the word.",
                    tr: "Kelimeyi eklediğinizde örnek cümle burada görünecektir."
                };
            }

            const type = getCategoryType(categoryTitle);
            const templates = sentenceTemplates[type] || sentenceTemplates['general'];
            
            // Kelimeye göre tutarlı bir şablon seçmek için basit bir hash işlemi
            // Böylece aynı kelimeye her zaman aynı örnek cümle gelir.
            let hash = 0;
            for (let i = 0; i < wordEN.length; i++) {
                hash = wordEN.charCodeAt(i) + ((hash << 5) - hash);
            }
            const index = Math.abs(hash) % templates.length;
            const template = templates[index];

            return {
                en: template.en.replace("[WORD]", `**${wordEN}**`),
                tr: template.tr.replace("[TR_WORD]", `**${wordTR}**`) // TR çeviri için basit yerleştirme
            };
        }


        // === VERİ İŞLEME VE OLUŞTURMA ===

        function generateAllData() { 
            const allData = {}; 
            
            // Simülasyon hedefleri (Kartlardaki doluluk oranı görüntüsü için)
            const targetLearned = {
                "Akademik Fiiller": 19,
                "En Çok Kullanılan İsimler": 30,
            };

            categories.forEach(category => {
                const unitsData = [];
                const units = realWordData[category] || {}; 
                let remainingLearned = targetLearned[category] || 0;

                for (let unitNum = 1; unitNum <= 20; unitNum++) {
                    const rawWords = units[unitNum] || []; 

                    // Kelimeleri işle ve cümle ekle
                    const wordsWithDetails = rawWords.map(w => {
                        const sentences = generateSmartSentence(w.en, w.tr, category);
                        return { 
                            ...w, 
                            exampleEN: sentences.en,
                            exampleTR: sentences.tr
                        };
                    }); 

                    const totalWords = wordsWithDetails.length; 
                    let learnedWords;
                    
                    if (category === "İleri Düzey Akademik Fiiller") {
                        // İlk iki ünitenin %70'ini öğrenilmiş göster
                        if (unitNum <= 2) {
                            learnedWords = Math.floor(totalWords * 0.7);
                        } else {
                            learnedWords = 0;
                        }
                    } else {
                        // Diğer kategoriler için simülasyon
                        // Dengeli dağılım
                        const remainingUnits = 20 - unitNum + 1;
                        let avgPerUnit = Math.floor(remainingLearned / remainingUnits);
                        if (remainingLearned % remainingUnits !== 0) avgPerUnit = Math.ceil(remainingLearned / remainingUnits);
                        learnedWords = Math.min(totalWords, avgPerUnit);
                        remainingLearned -= learnedWords;
                    }

                    unitsData.push({ 
                        unit: unitNum, 
                        totalWords: totalWords, 
                        learnedWords: learnedWords, 
                        words: wordsWithDetails, 
                        colorClass: 'u' + ((unitNum - 1) % 20 + 1) 
                    });
                }
                allData[category] = unitsData;
            });
            return allData; 
        }
        
        const cardUnitData = generateAllData();

        function shuffleArray(array) { 
            for (let i = array.length - 1; i > 0; i--) { 
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; 
            } 
            return array; 
        } 
        
        // === UI GÜNCELLEMELERİ ===

        function updateHomePageCards() {
            document.querySelectorAll('#home-page .card').forEach(card => {
                const title = card.querySelector('h3').textContent;
                const info = cardUnitData[title];
                if (info) {
                    let totalWords = 0;
                    let totalLearned = 0;
                    info.forEach(unit => {
                        totalWords += unit.totalWords;
                        totalLearned += unit.learnedWords;
                    });
                    
                    const displayTotalWords = (title === "İleri Düzey Akademik Fiiller") ? 400 : 200; 
                    const displayTotalLearned = totalLearned;

                    const percentage = displayTotalWords > 0 ? (displayTotalLearned / displayTotalWords) * 100 : 0;
                    const cardInfo = card.querySelector('.card-info');
                    
                    cardInfo.querySelector('p').textContent = `${displayTotalWords} kelimeden ${displayTotalLearned} tanesi öğrenildi.`;
                    cardInfo.querySelector('.progress-fill').style.width = `${percentage.toFixed(0)}%`;
                }
            });
        }

        document.addEventListener('DOMContentLoaded', updateHomePageCards);

        // === NAVİGASYON ===

        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let totalQuestions = 0;
        let currentUnitNumber = null;
        let currentUnitColorClass = '';
        let currentUnitTitle = '';
        let currentCategoryTitle = '';
        
        const backButton = document.getElementById('back-button');
        const headerTitle = document.querySelector('header h1');
        const unitTimeline = document.querySelector('#detail-page .timeline');
        const wordListContainer = document.getElementById('word-list-container');
        const detailUnitProgress = document.getElementById('detail-unit-progress');
        
        let navigationStack = [];

        function navigateTo(targetPageId, level, title) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(targetPageId).classList.add('active');
            
            // Sayfanın en üstüne kaydır
            window.scrollTo(0, 0);

            if (level === 0) {
                backButton.style.display = 'none';
                headerTitle.textContent = 'EnglishBox';
                navigationStack = [];
            } else {
                backButton.style.display = 'inline-flex';
                backButton.setAttribute('data-page-level', level);
                headerTitle.textContent = title;
                
                const lastState = navigationStack[navigationStack.length - 1];
                if (!lastState || lastState.id !== targetPageId) {
                     // Sadece 'quiz-page' ise stack'e ekleme, geri tuşuyla geri dönülememeli
                     if (targetPageId !== 'quiz-page') {
                        navigationStack.push({ id: targetPageId, level: level, title: title });
                    }
                }
            }
        }

        function goBack() {
            if (navigationStack.length > 0) {
                // Quiz sayfasından geliyorsa, son iki state'i pop et (Quiz -> Unit Detail)
                if (navigationStack[navigationStack.length - 1].id === 'quiz-page') {
                    navigationStack.pop(); // Quiz'i kaldır
                    if (navigationStack.length > 0) {
                        navigationStack.pop(); // Unit Detail'ı kaldır
                    } else {
                         navigateTo('home-page', 0, 'EnglishBox');
                         return;
                    }
                } else {
                    navigationStack.pop();
                }
                
                if (navigationStack.length === 0) {
                     navigateTo('home-page', 0, 'EnglishBox');
                     return;
                }
                
                const prevPage = navigationStack[navigationStack.length - 1];
                
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => page.classList.remove('active'));
                document.getElementById(prevPage.id).classList.add('active');
                
                headerTitle.textContent = prevPage.title;
                backButton.setAttribute('data-page-level', prevPage.level);
                
                if (prevPage.id === 'home-page') {
                    backButton.style.display = 'none';
                    headerTitle.textContent = 'EnglishBox';
                }
                
                // Quiz temizliği
                const results = document.querySelector('#quiz-page .quiz-results');
                if (results) {
                    results.remove();
                    document.querySelector('.quiz-header-word').style.display = 'flex';
                }

                if (prevPage.id === 'detail-page' && currentCategoryTitle) {
                    loadTimeline(cardUnitData[currentCategoryTitle], currentCategoryTitle);
                }

            } else {
                navigateTo('home-page', 0, 'EnglishBox');
            }
        }

        backButton.addEventListener('click', goBack);

        document.querySelectorAll('.card, .btn-continue').forEach(el => {
            el.addEventListener('click', (e) => {
                e.stopPropagation();
                // Butonsa data attribute'dan, kartsat h3'den al
                let title = el.getAttribute('data-card-title');
                if(!title) title = el.querySelector('h3').textContent;
                
                currentCategoryTitle = title;
                loadDetailPage(title);
                navigateTo('detail-page', 1, title);
            });
        });

        // === DETAY SAYFALARI ===

        function loadDetailPage(categoryTitle) {
            const units = cardUnitData[categoryTitle];
            unitTimeline.innerHTML = '';
            let totalWords = 0, totalLearned = 0;

            units.forEach(unit => {
                totalWords += unit.totalWords; 
                totalLearned += unit.learnedWords;
            });

            // Görüntülenen toplam kelime sayısı
            const displayTotalWords = (categoryTitle === "İleri Düzey Akademik Fiiller") ? 400 : 200; 

            const learnedRate = displayTotalWords > 0 ? ((totalLearned / displayTotalWords) * 100).toFixed(0) : 0;
            const correctRate = Math.min(100, (Number(learnedRate) * 1.5)).toFixed(0);

            document.getElementById('detail-correct-rate').textContent = `% ${correctRate}`;
            document.getElementById('detail-learned-rate').textContent = `% ${learnedRate}`;
            
            loadTimeline(units, categoryTitle);
        }

        function loadUnitDetailPage(unitNumber, unitTitle, totalWords, learnedWords, colorClass, words) {
            currentUnitNumber = unitNumber;
            currentUnitColorClass = colorClass;
            currentUnitTitle = unitTitle;

            document.getElementById('detail-unit-circle').textContent = unitNumber;
            document.getElementById('detail-unit-circle').className = 'unit-progress-circle ' + colorClass;
            detailUnitProgress.textContent = `${learnedWords}/${totalWords} kelime öğrenildi.`;

            wordListContainer.innerHTML = '';
            words.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                
                const isPlaceholder = word.en.startsWith('[');
                
                // Placeholder stilleri
                const iconColor = isPlaceholder ? '#ccc' : '';
                const iconBg = isPlaceholder ? '#f7f7f7' : '';
                const textColor = isPlaceholder ? '#ccc' : 'var(--color-dark)';
                const trColor = isPlaceholder ? '#ccc' : '#888';
                const iconClass = isPlaceholder ? 'fa-lock' : 'fa-cube';

                wordItem.innerHTML = `
                    <div class="word-icon-placeholder" style="background-color: ${iconBg}; color: ${iconColor};">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="word-text-group">
                        <span class="word-english" style="color: ${textColor};">${word.en}</span>
                        <span class="word-turkish" style="color: ${trColor};">${isPlaceholder ? '(Doldurulacak Alan)' : word.tr}</span>
                    </div>
                `;

                wordItem.addEventListener('click', () => {
                    if (isPlaceholder) {
                        alert("Bu alana henüz kelime eklenmemiştir. Lütfen kodu düzenleyerek kelime ekleyiniz.");
                    } else {
                        loadWordDetailPage(word);
                    }
                });
                
                wordListContainer.appendChild(wordItem);
            });
        }

        function loadWordDetailPage(wordData) {
            document.getElementById('word-icon-main').innerHTML = '<i class="fas fa-cube"></i>';
            document.getElementById('detail-english-word').textContent = wordData.en;
            document.getElementById('detail-turkish-word').textContent = wordData.tr;
            document.getElementById('example-sentence-en').innerHTML = wordData.exampleEN; // HTML render et (bold için)
            document.getElementById('example-sentence-tr').innerHTML = wordData.exampleTR;

            navigateTo('word-detail-page', 3, wordData.en);
        }

        function loadTimeline(units, categoryTitle) {
            unitTimeline.innerHTML = '';
            units.forEach(unit => {
                const subtitleText = `${unit.learnedWords}/${unit.totalWords} kelime öğrenildi.`;
                const unitItem = document.createElement('div');
                unitItem.className = 'unit-item';
                unitItem.innerHTML = `
                    <div class="unit-circle ${unit.colorClass}">${unit.unit}</div>
                    <div class="unit-content">
                        <div class="unit-title">Ünite ${unit.unit}</div>
                        <div class="unit-subtitle"><span style="font-weight: normal; color: #888;">${subtitleText}</span></div>
                    </div>
                `;
                if (currentUnitNumber === unit.unit && currentCategoryTitle === categoryTitle) {
                    unitItem.classList.add('selected');
                }
                unitItem.addEventListener('click', () => {
                    document.querySelectorAll('.unit-item').forEach(item => item.classList.remove('selected'));
                    unitItem.classList.add('selected');
                    loadUnitDetailPage(unit.unit, categoryTitle, unit.totalWords, unit.learnedWords, unit.colorClass, unit.words);
                    navigateTo('unit-detail-page', 2, `${categoryTitle} - Ünite ${unit.unit}`);
                });
                unitTimeline.appendChild(unitItem);
            });
        }
        
        // === QUIZ SİSTEMİ ===

        function generateQuiz(unitWords, numQuestions = 10, categoryTitle) {
            const quizQuestions = [];
            // Placeholder olmayan kelimeleri bul
            const realWords = unitWords.filter(w => !w.en.startsWith('['));

            if (realWords.length === 0) return []; // Hiç kelime yoksa boş dön

            const wordsToQuiz = shuffleArray([...realWords]).slice(0, numQuestions); 
            
            // Şıklar için aynı kategoriden diğer kelimeleri topla
            let allTranslations = [];
            if (cardUnitData[categoryTitle]) {
                 cardUnitData[categoryTitle].forEach(unit => {
                    unit.words.forEach(word => {
                        if (!word.en.startsWith('[')) {
                            allTranslations.push(word.tr);
                        }
                    });
                });
            }
            // Eğer yeterince çeviri yoksa (henüz kelime girilmediyse), dummy veriler ekle
            if(allTranslations.length < 4) {
                allTranslations = ["Örnek Cevap A", "Örnek Cevap B", "Örnek Cevap C", "Doğru Cevap"];
            }

            wordsToQuiz.forEach(word => {
                const correctAnswer = word.tr;
                const options = [correctAnswer];
                let distractorPool = allTranslations.filter(t => t !== correctAnswer);
                distractorPool = shuffleArray(distractorPool);
                
                for (let i = 0; options.length < 4 && i < distractorPool.length; i++) {
                    if (!options.includes(distractorPool[i])) options.push(distractorPool[i]);
                }
                while(options.length < 4) options.push('...'); 

                quizQuestions.push({
                    question: word.en,
                    correctAnswer: correctAnswer,
                    options: shuffleArray(options)
                });
            });

            return quizQuestions;
        }

        const quizQuestionText = document.getElementById('quiz-question-text');
        const quizOptionsContainer = document.getElementById('quiz-options');
        const quizQuestionCounter = document.getElementById('quiz-question-counter');

        function startQuiz() {
            if (currentUnitNumber === null) return;

            const unitData = cardUnitData[currentCategoryTitle].find(u => u.unit === currentUnitNumber);
            // Gerçek kelime var mı kontrol et
            const realWordsCount = unitData.words.filter(w => !w.en.startsWith('[')).length;
            
            if (!unitData || realWordsCount === 0) {
                 alert("⚠️ Bu ünitede henüz aktif kelime bulunmamaktadır.\n\nLütfen kod içerisindeki [EN KELİME X] alanlarını gerçek kelimelerle değiştiriniz.");
                 return;
            }

            const numQuestions = Math.min(10, realWordsCount);
            
            score = 0;
            currentQuestionIndex = 0;
            currentQuiz = generateQuiz(unitData.words, numQuestions, currentCategoryTitle);
            
            if (currentQuiz.length === 0) {
                 alert("Quiz başlatılamadı.");
                 return;
            }

            totalQuestions = currentQuiz.length;
            const results = document.querySelector('.quiz-results');
            if (results) results.remove();
            document.querySelector('.quiz-header-word').style.display = 'flex';
            navigateTo('quiz-page', 3, `Quiz: Ünite ${currentUnitNumber}`);
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                showResults();
                return;
            }

            const questionData = currentQuiz[currentQuestionIndex];
            quizQuestionText.textContent = questionData.question.toLowerCase();
            quizQuestionCounter.textContent = `${currentQuestionIndex + 1} / ${totalQuestions}`;
            quizOptionsContainer.innerHTML = '';
            quizOptionsContainer.classList.remove('answered');

            questionData.options.forEach(optionText => {
                const option = document.createElement('div');
                option.className = 'quiz-option';
                option.textContent = optionText.toLowerCase();
                option.addEventListener('click', () => checkAnswer(option, optionText, questionData.correctAnswer));
                quizOptionsContainer.appendChild(option);
            });
        }

        function checkAnswer(selectedOption, selectedAnswer, correctAnswer) {
            quizOptionsContainer.classList.add('answered');

            if (selectedAnswer === correctAnswer) {
                selectedOption.classList.add('correct');
                score++;
            } else {
                selectedOption.classList.add('incorrect');
                document.querySelectorAll('.quiz-option').forEach(option => {
                    if (option.textContent === correctAnswer.toLowerCase()) option.classList.add('correct');
                });
            }
            setTimeout(() => { 
                currentQuestionIndex++; 
                displayQuestion(); 
            }, 1200);
        }

        function showResults() {
            quizOptionsContainer.innerHTML = '';
            const percentage = totalQuestions > 0 ? ((score / totalQuestions) * 100).toFixed(0) : 0;
            const resultText = percentage >= 70 ? "Tebrikler, başarılı bir sonuç!" : "Daha fazla tekrar gerekiyor.";
            const resultsHtml = `
                <div class="quiz-results">
                    <h2>Quiz Tamamlandı!</h2> 
                    <p>${resultText}</p>
                    <div class="results-score-circle" style="background-color: ${percentage >= 70 ? 'var(--color-green)' : 'var(--color-red)'};">%${percentage}</div>
                    <p>Doğru: ${score}</p>
                    <p>Toplam Soru: ${totalQuestions}</p>
                    <button class="action-button btn-back-to-list" onclick="goBack()" style="margin-top: 20px;"><i class="fas fa-home"></i> Üniteye Geri Dön</button>
                </div>
            `;
            const quizPageContent = document.getElementById('quiz-page');
            document.querySelector('.quiz-header-word').style.display = 'none';
            quizPageContent.insertAdjacentHTML('beforeend', resultsHtml);
        }

        // Başlangıç
        navigateTo('home-page', 0, 'EnglishBox');
    </script>
</body>
</html>
