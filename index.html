<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnglishBox Quiz App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* GENEL AYARLAR */
        :root {
            --bg-light-gray: #f2f2f7;
            --color-primary: #3498db;
            --color-dark: #333;
            --color-light-gray: #eee;
            --color-yellow: #f1c40f;
            --color-red: #e74c3c;
            --color-green: #a3cb38;
            --color-icon-bg: #ecf0f1;
        }

        * { box-sizing: border-box; margin: 0; padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body {
            background-color: var(--bg-light-gray);
            display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
        }

        .mobile-container {
            width: 100%;
            max-width: 400px; background-color: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1); position: relative;
            overflow: hidden; min-height: 700px; padding-bottom: 0;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: flex-start; align-items: center;
            padding: 15px 20px; background-color: #fff;
            border-bottom: 1px solid var(--color-light-gray);
            position: sticky; top: 0; z-index: 10;
        }
        .header-content { display: flex; align-items: center;
        }
        header h1 { font-size: 18px; font-weight: bold; margin-left: 0;
        }
        .back-button {
            color: var(--color-dark);
            cursor: pointer; font-size: 18px;
            background: none; border: none; padding: 0; line-height: 1; margin-right: 15px;
        }

        /* SAYFA YAPISI */
        .page { display: none;
        opacity: 0; transition: opacity 0.3s ease; width: 100%; }
        .page.active { display: block;
        opacity: 1; }
        
        #unit-detail-page.active, #word-detail-page.active {
            display: flex;
            flex-direction: column; height: 100%; position: relative; padding-bottom: 70px;
        }
        
        /* KART STİLLERİ */
        .card {
            background: #fff;
            margin: 15px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid var(--color-light-gray);
            overflow: hidden; cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .card:active { transform: scale(0.99);
        }
        .card:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .card-content { padding: 15px; display: flex; align-items: center;
        }
        .card-icon-wrapper {
            width: 60px;
            height: 60px; border-radius: 50%; margin-right: 15px;
            display: flex; align-items: center; justify-content: center; color: #fff; font-size: 24px; flex-shrink: 0;
        }
        .icon-verb { background-color: #34495e;
        }
        .icon-noun { background-color: #e91e63;
        }
        .icon-adj { background-color: var(--color-green);
        }
        .icon-adv { background-color: #e67e22;
        }
        .icon-conj { background-color: #9b59b6;
        }
        .icon-phrasal { background-color: var(--color-primary);
        }
        .card-info { flex-grow: 1;
        }
        .card-info h3 { font-size: 16px; margin-bottom: 5px; color: var(--color-dark);
        }
        .card-info p { font-size: 13px; color: #888; margin-bottom: 8px;
        }
        .progress-bar { height: 6px; background-color: var(--color-light-gray); border-radius: 3px; width: 100%;
        }
        .progress-fill { height: 100%; background-color: var(--color-primary); width: 0%; border-radius: 3px;
        transition: width 0.5s ease; } 
        .btn-continue {
            width: 100%;
            padding: 12px; background: #fff; border: none;
            border-top: 1px solid var(--color-light-gray); color: var(--color-dark);
            font-weight: bold; font-size: 14px; cursor: pointer; text-transform: uppercase;
            transition: background 0.2s, color 0.2s;
        }
        .btn-continue:hover { background-color: #f5f5f5;
        }

        /* DETAY SAYFASI */
        /* Stats-row silindi */
        .percentage-row {
            display: flex;
            justify-content: space-between; padding: 10px 20px; background: #fff;
            font-weight: bold; font-size: 14px; margin-bottom: 20px;
            border-top: 1px solid var(--color-light-gray);
            border-bottom: 1px solid var(--color-light-gray);
        }
        .percentage-row .percentage-value { color: #f39c12;
        }
        .percentage-row .label { font-weight: normal; color: #666; font-size: 12px;
        }

        /* Timeline / Ünite Listesi */
        .timeline { padding: 0 20px;
        }
        .unit-item {
            display: flex;
            align-items: center; position: relative; padding: 15px 10px;
            cursor: pointer; transition: background-color 0.2s; border-radius: 8px; margin-bottom: 8px;
            opacity: 1; background-color: #fff;
            border: 1px solid var(--color-light-gray);
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .unit-item.selected { background-color: #f0f8ff;
        border: 1px solid #cceeff; }
        .unit-item:hover { background-color: #f9f9f9;
        }
        .unit-circle {
            width: 40px;
            height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: #fff; font-weight: bold; flex-shrink: 0; z-index: 2;
        }
        .unit-content { margin-left: 15px;
        }
        .unit-title { font-weight: bold; color: var(--color-dark); font-size: 16px;
        }
        .unit-subtitle { font-size: 13px; color: #999; margin-top: 4px;
        }
        
        .u1, .u6, .u11, .u16, .u21 { background-color: #e91e63;
        }
        .u2, .u7, .u12, .u17 { background-color: var(--color-primary);
        }
        .u3, .u8, .u13, .u18 { background-color: #000;
        }
        .u4, .u9, .u14, .u19 { background-color: var(--color-green);
        }
        .u5, .u10, .u15, .u20 { background-color: #e67e22;
        }

        /* ÜNİTE DETAY & KELİME LİSTESİ */
        .unit-detail-info { padding: 20px;
        text-align: center; flex-shrink: 0; }
        .unit-progress-circle {
            width: 120px;
            height: 120px; border-radius: 50%; background-color: var(--color-primary);
            color: #fff; font-size: 36px; font-weight: bold; display: flex; align-items: center;
            justify-content: center;
            margin: 0 auto 10px auto;
        }
        .unit-detail-info p { font-size: 14px; color: #888;
        margin-bottom: 10px; height: 18px; }
        .unit-detail-info .word-count-info { font-size: 16px; font-weight: bold;
        color: var(--color-dark); margin-top: 10px; }
        
        .bottom-actions { 
            position: fixed;
            bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 400px;
            background-color: #fff; padding: 15px 20px; box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            z-index: 100; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0;
        }
        .action-button {
            width: 100%;
            padding: 15px; border: none; border-radius: 12px; font-size: 16px;
            font-weight: bold; color: #fff; cursor: pointer; display: flex; align-items: center;
            justify-content: center;
            gap: 10px; margin: 0;
        }
        .btn-quiz { background-color: var(--color-green);
        }
        .btn-back-to-list { background-color: var(--color-primary);
        } 

        .unit-word-list { padding: 0 15px 10px 15px; overflow-y: auto; flex-grow: 1;
        }
        
        .word-item { display: flex;
        align-items: center; padding: 10px 0; border-bottom: 1px solid var(--color-light-gray); cursor: pointer;
        } 
        .word-item:last-child { border-bottom: none;
        }
        
        .word-icon-placeholder {
            width: 50px;
            height: 50px; border-radius: 8px; margin-right: 15px;
            display: flex; align-items: center; justify-content: center; background-color: var(--color-icon-bg);
            color: var(--color-primary); font-size: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .word-text-group { display: flex;
        flex-direction: column; }
        .word-english { font-weight: bold; color: var(--color-dark); font-size: 16px; text-transform: capitalize;
        }
        .word-turkish { font-size: 14px; color: #888; text-transform: lowercase;
        }

        /* QUIZ SAYFASI */
        #quiz-page { display: flex;
        flex-direction: column; padding: 0 20px; text-align: center; }
        .quiz-header-word { padding: 30px 0;
        margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
        .quiz-speaker-icon { font-size: 36px;
        color: var(--color-yellow); margin-bottom: 10px; cursor: pointer; }
        #quiz-question-text { font-size: 32px; color: var(--color-dark);
        font-weight: bold; margin: 0; text-transform: capitalize; }
        #quiz-question-counter { font-size: 14px; color: #999;
        margin-top: 10px; font-weight: normal; }
        .options-container { display: flex; flex-direction: column; gap: 15px;
        }
        .quiz-option {
            padding: 20px 15px;
            background-color: #fff; border: 1px solid var(--color-light-gray);
            border-radius: 12px; text-align: center; font-weight: bold; font-size: 16px; color: var(--color-dark);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.1s;
        }
        .quiz-option.correct { background-color: var(--color-green); color: white; border-color: var(--color-green); pointer-events: none;
        animation: pulse-correct 0.5s ease; }
        .quiz-option.incorrect { background-color: var(--color-red); color: white; border-color: var(--color-red);
        pointer-events: none; animation: shake-incorrect 0.3s ease; }
        .options-container.answered .quiz-option:not(.correct):not(.incorrect) { opacity: 0.5;
        pointer-events: none; }
        .quiz-results {
            margin-top: 50px;
            padding: 20px; background-color: var(--bg-light-gray); border-radius: 15px; text-align: center;
        }
        .results-score-circle {
            width: 100px;
            height: 100px; border-radius: 50%; background-color: var(--color-green);
            color: white; font-size: 28px; font-weight: bold; display: flex; align-items: center;
            justify-content: center;
            margin: 20px auto; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* KELİME DETAY SAYFASI */
        .word-detail-content { padding: 20px;
        display: flex; flex-direction: column; align-items: center; }
        #word-icon-main {
            width: 150px;
            height: 150px; border-radius: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); background-color: var(--color-icon-bg);
            color: var(--color-primary); display: flex; align-items: center;
            justify-content: center; font-size: 70px;
        }
        .word-main-info { text-align: center; margin-bottom: 20px;
        }
        #detail-english-word { font-size: 30px; font-weight: bold; color: var(--color-dark); text-transform: capitalize; display: inline-block;
        margin-right: 10px; }
        #detail-turkish-word { font-size: 18px; color: var(--color-primary); font-weight: 500; display: block;
        margin-top: 5px; }
        .example-section {
            background-color: var(--bg-light-gray);
            padding: 15px; border-radius: 12px; width: 100%;
            text-align: left; margin-bottom: 20px; border-left: 5px solid var(--color-yellow);
        }
        .example-section h4 { font-size: 16px; color: var(--color-dark); margin-bottom: 10px; display: flex;
        align-items: center; gap: 8px; }
        .example-sentence-en { font-style: italic; font-size: 15px; line-height: 1.5;
        color: #555; margin-bottom: 8px; }
        .example-sentence-tr { font-size: 14px; line-height: 1.5; color: #999;
        margin-top: -5px; }
        .speaker-icon-small { color: var(--color-dark); cursor: pointer; font-size: 20px; margin-left: 10px;
        }

        @keyframes pulse-correct { 0% { transform: scale(1); } 50% { transform: scale(1.05);
        } 100% { transform: scale(1); } }
        @keyframes shake-incorrect { 0%, 100% { transform: translateX(0);
        } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px);
        } }
    </style>
</head>
<body>

    <div class="mobile-container">
        
        <header>
            <div class="header-content">
                <button id="back-button" class="back-button" style="display: none;"
                data-page-level="1">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1></h1> 
            </div>
        </header>

        <div id="home-page" class="page active">
            <div class="card"><div 
                class="card-content"><div class="card-icon-wrapper icon-verb"><i class="fas fa-book-open"></i></div><div class="card-info"><h3>İleri Düzey Akademik Fiiller</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="İleri Düzey Akademik Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-verb"><i class="fas fa-running"></i></div><div class="card-info"><h3>Akademik Fiiller</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Fiiller">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-adj"><i class="fas fa-star"></i></div><div class="card-info"><h3>Akademik Sıfatlar</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Sıfatlar">DEVAM ET</button></div>
          
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-noun"><i class="fas fa-building"></i></div><div class="card-info"><h3>Akademik İsimler</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" 
            data-card-title="Akademik İsimler">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-conj"><i class="fas fa-link"></i></div><div class="card-info"><h3>Akademik Bağlaçlar</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Bağlaçlar">DEVAM ET</button></div>
            <div class="card"><div class="card-content"><div class="card-icon-wrapper icon-phrasal"><i class="fas fa-dice"></i></div><div class="card-info"><h3>Öbek Fiiller</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Öbek Fiiller">DEVAM ET</button></div>
            <div class="card"><div 
            class="card-content"><div class="card-icon-wrapper icon-adv"><i class="fas fa-clock"></i></div><div class="card-info"><h3>Akademik Zarflar</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="Akademik Zarflar">DEVAM ET</button></div>
            <div class="card"><div 
            class="card-content"><div class="card-icon-wrapper icon-noun"><i class="fas fa-users"></i></div><div class="card-info"><h3>En Çok Kullanılan İsimler</h3><p>Hesaplanıyor...</p><div class="progress-bar"><div class="progress-fill" style="width: 0%"></div></div></div></div><button class="btn-continue" data-card-title="En Çok Kullanılan İsimler">DEVAM ET</button></div>
        </div>

        <div id="detail-page" class="page">
            <div class="percentage-row">
                <div class="percentage-item"><span class="percentage-value" id="detail-correct-rate">% 10</span> <span class="label">Doğru yanıtlar</span></div>
                <div class="percentage-item"><span class="percentage-value" id="detail-learned-rate">% 5</span> 
                <span class="label">Öğrenilenlerin oranı</span></div>
            </div>
            <div 
            class="timeline"></div>
        </div>

        <div id="unit-detail-page" class="page">
            <div class="unit-detail-info">
                <div class="unit-progress-circle" id="detail-unit-circle">1</div>
                <p id="detail-unit-progress" class="word-count-info"></p>
      
                </div>
           
            <div class="unit-word-list" id="word-list-container"></div>
            <div class="bottom-actions">
                <button class="action-button btn-quiz" onclick="startQuiz()">
                     <i class="fas fa-question-circle"></i> Quiz Çöz
                </button>
      
                </div>
 
        </div>
        
        <div id="word-detail-page" class="page">
            <div class="word-detail-content">
                <div id="word-icon-main"><i class="fas fa-cube"></i></div>
                <div class="word-main-info">
                   
       
                <span id="detail-english-word"></span>
                    <i class="fas fa-volume-up speaker-icon-small" onclick="alert('Seslendirildi!')"></i>
                    <span id="detail-turkish-word"></span>
                </div>
                <div class="example-section">
        
                <h4><i class="fas fa-lightbulb"></i> Örnek 
                Cümle</h4>
                    <p id="example-sentence-en" class="example-sentence-en"></p>
                    <p id="example-sentence-tr" class="example-sentence-tr"></p>
                </div>
            
            </div>
            <div class="bottom-actions">
               
                <button class="action-button btn-back-to-list" onclick="goBack()">
                    <i class="fas fa-list-ul"></i> Kelime Listesine Dön
                </button>
            
            </div>
        </div>

        <div id="quiz-page" class="page">
            <div class="quiz-header-word">
           
                <i class="fas fa-volume-up quiz-speaker-icon" onclick="alert('Seslendirildi!')"></i>
                <h3 id="quiz-question-text"></h3>
                 <p id="quiz-question-counter"></p>
   
            </div>
            <div id="quiz-options" class="options-container">
            </div>
        </div>

    </div>

    <script>
        // === GEREKLİ GLOBAL DEĞİŞKENLER ===
        let currentCategoryTitle = '';
        let currentUnitWords = [];
        let currentUnitNumber = null;
        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let totalQuestions = 0;
        let navigationStack = [];
        let globalTranslationPool = []; 
        let cardUnitData = {}; 

        const backButton = document.getElementById('back-button');
        const headerTitle = document.querySelector('header h1');
        const cards = document.querySelectorAll('#home-page .card');

        // === GÜNCEL VE ZENGİNLEŞTİRİLMİŞ VERİ BÖLÜMÜ ===

        const realWordData = {
            "İleri Düzey Akademik Fiiller": {
                1: [
                    { en: "Analyze", tr: "Analiz Etmek" }, { en: "Identify", tr: "Tanımlamak, Belirlemek" },
                    { en: "Determine", tr: "Saptamak, Karar Vermek" }, { en: "Establish", tr: "Kurmak, Oluşturmak, Saptamak" },
                    { en: "Investigate", tr: "Araştırmak, İncelemek" }, { en: "Illustrate", tr: "Örneklemek, Açıklamak" },
                    { en: "Demonstrate", tr: "Göstermek, Kanıtlamak" }, { en: "Evaluate", tr: "Değerlendirmek" },
                    { en: "Synthesize", tr: "Sentezlemek" }, { en: "Formulate", tr: "Formüle Etmek, Geliştirmek" },
                    { en: "Define", tr: "Tanımlamak" }, { en: "Compare", tr: "Karşılaştırmak" },
                    { en: "Contrast", tr: "Karşıtlık Kurmak, Farklılıkları Belirtmek" }, { en: "Argue", tr: "Tartışmak, İddia Etmek" },
                    { en: "Support", tr: "Desteklemek" }, { en: "Challenge", tr: "Sorgulamak, Meydan Okumak" },
                    { en: "Derive", tr: "Türetmek, Elde Etmek" }, { en: "Indicate", tr: "İşaret Etmek, Göstermek" },
                    { en: "Suggest", tr: "Öne Sürmek, Önermek" }, { en: "Conclude", tr: "Sonuçlandırmak" }
                ],
                2: [
                    { en: "Perceive", tr: "Algılamak" }, { en: "Propose", tr: "Teklif Etmek, Önermek" },
                    { en: "Observe", tr: "Gözlemlemek" }, { en: "Examine", tr: "İncelemek, Muayene Etmek" },
                    { en: "Apply", tr: "Uygulamak" }, { en: "Implement", tr: "Uygulamaya Koymak" },
                    { en: "Reflect", tr: "Yansıtmak, Düşünmek" }, { en: "Relate", tr: "İlişkilendirmek" },
                    { en: "Discuss", tr: "Tartışmak" }, { en: "Differentiate", tr: "Ayırt Etmek, Farklılaştırmak" },
                    { en: "Validate", tr: "Doğrulamak, Onaylamak" }, { en: "Generate", tr: "Üretmek, Oluşturmak" },
                    { en: "Evolve", tr: "Gelişmek, Evrilmek" }, { en: "Comprise", tr: "İçermek, Kapsamak" },
                    { en: "Precede", tr: "Önce Gelmek" }, { en: "Succeed", tr: "Başarılı Olmak, Yerine Geçmek" },
                    { en: "Cite", tr: "Alıntı Yapmak" }, { en: "Integrate", tr: "Bütünleştirmek" },
                    { en: "Modify", tr: "Değiştirmek, Uyarlamak" }, { en: "Replicate", tr: "Tekrarlamak, Çoğaltmak" }
                ],
                3: [
                    { en: "Signify", tr: "İfade Etmek, Anlamına Gelmek" }, { en: "Account for", tr: "Açıklamak, Sorumlu Olmak" },
                    { en: "Assess", tr: "Değer Biçmek, Değerlendirmek" }, { en: "Contribute", tr: "Katkıda Bulunmak" },
                    { en: "Correlate", tr: "İlişkilendirmek, Korelasyon Kurmak" }, { en: "Emphasize", tr: "Vurgulamak" },
                    { en: "Extract", tr: "Çıkarmak, Özütlemek" }, { en: "Hypothesize", tr: "Hipotez Kurmak" },
                    { en: "Justify", tr: "Gerekçelendirmek" }, { en: "Reveal", tr: "Ortaya Çıkarmak, Açığa Vurmak" },
                    { en: "Envisage", tr: "Öngörmek, Zihninde Canlandırmak" }, { en: "Exclude", tr: "Hariç tutmak, Dışlamak" },
                    { en: "Expend", tr: "Harcamak, Tüketmek (kaynak, zaman)" }, { en: "Facilitate", tr: "Kolaylaştırmak" },
                    { en: "Fluctuate", tr: "Dalgalanmak, İnip çıkmak" }, { en: "Foster", tr: "Geliştirmek, Teşvik etmek, Beslemek" },
                    { en: "Globalize", tr: "Küreselleştirmek" }, { en: "Guarantee", tr: "Garanti etmek" },
                    { en: "Hinder", tr: "Engellemek, Önlemek" }, { en: "Imply", tr: "Kastetmek, İma etmek, Çıkarım Yapmak" }
                ],
                // ... (Diğer İleri Düzey Fiiller üniteleri olduğu gibi bırakıldı)
                4: [
                    { en: "Incur", tr: "Maruz kalmak, Uğramak (masraf, zarar)" }, { en: "Infer", 
                    tr: "Çıkarım yapmak, Sonuç çıkarmak" },
                    { en: "Inhibit", tr: "Engellemek, Ket vurmak" }, { en: "Initiate", tr: "Başlatmak, Girişimde bulunmak" },
                    { en: "Innovate", tr: "Yenilik yapmak" }, { en: "Insert", tr: "Eklemek, Sokmak, Araya koymak" },
                    { en: "Intervene", tr: "Müdahale etmek, Araya girmek" }, { en: "Mandate", tr: "Zorunlu kılmak, Yetki vermek" },
                    { en: "Mediate", tr: "Arabuluculuk yapmak" }, { en: "Merge", tr: "Birleştirmek, Kaynaşmak" },
                    { en: "Minimize", tr: "Asgariye indirmek, Küçültmek" }, { en: "Negate", tr: "Yadsımak, Geçersiz kılmak" },
                    { en: "Negotiate", tr: "Müzakere etmek, Görüşmek" }, { en: "Obtain", tr: "Elde etmek, Edinmek" },
                    { en: "Occur", tr: "Meydana gelmek, Oluşmak" }, { en: "Omit", tr: "Atlamak, Hariç bırakmak" },
                    { en: "Oversee", tr: "Denetlemek, Gözetlemek" }, { en: "Parallel", tr: "Paralellik kurmak" }
                ],
                5: [ 
                    { en: "Participate", tr: "Katılmak" }, { en: "Permit", tr: "İzin vermek" }, { en: "Pertain", tr: "İlişkili olmak, Ait olmak" }, 
                    { en: "Phase", tr: "Aşamalara ayırmak" }, { en: "Postulate", tr: "Varsaymak, Öncül olarak kabul etmek" }, 
                    { en: "Precede", tr: "Önce gelmek" }, { en: "Predict", tr: "Tahmin etmek, Yordamak" }, { en: "Prescribe", tr: "Önermek, Reçetelemek, Emretmek" }, { en: "Presume", tr: "Varsaymak, Sanmak" }, { en: "Prevail", tr: "Yaygın olmak, Baskın çıkmak" },
                    { en: "Proceed", tr: "Devam etmek, İlerlemek" }, { en: "Prohibit", tr: "Yasaklamak, Engellemek" },
                    { en: "Promulgate", tr: "Yayınlamak, İlan etmek" }, 
                    { en: "Propel", tr: "İtmek, Harekete geçirmek" },
                    { en: "Purport", tr: "İddia etmek, Görünmek" }, { en: "Qualify", tr: "Niteliklerini belirtmek, Sınırlamak" }, 
                ]
            },
            "Akademik Fiiller": {
                1: [
                    { en: "Create", tr: "Yaratmak, Oluşturmak" }, { en: "Involve", tr: "İçermek, Kapsamak" },
                    { en: "Interact", tr: "Etkileşimde bulunmak" }, { en: "Exceed", tr: "Aşmak, Geçmek" },
                    { en: "Constitute", tr: "Oluşturmak, Teşkil etmek" }, { en: "Interact", tr: "Etkileşimde bulunmak" }, { en: "Exceed", tr: "Aşmak, Geçmek" }
                ],
                2: [
                    { en: "Sustain", tr: "Sürdürmek, Ayakta tutmak" }, { en: "Achieve", tr: "Ulaşmak, Başarmak" }, { en: "Advance", tr: "İlerlemek, Gelişmek" }, { en: "Contribute", tr: "Katkıda bulunmak" }, { en: "Define", tr: "Tanımlamak" }, { en: "Emphasize", tr: "Vurgulamak" }, { en: "Focus on", tr: "Odaklanmak" }, { en: "Highlight", tr: "Vurgulamak, Öne çıkarmak" }, { en: "Imply", tr: "İma etmek" }, { en: "Predict", tr: "Tahmin etmek" }
                ],
                3: [
                    { en: "Emerge", tr: "Ortaya çıkmak" }, { en: "Involve", tr: "İçermek, Kapsamak" }, { en: "Limit", tr: "Sınırlamak" }, { en: "Maintain", tr: "Sürdürmek, Korumak" }, { en: "Relate to", tr: "İle ilgili olmak" }, { en: "Require", tr: "Gerektirmek" }, { en: "Signify", tr: "Anlamına gelmek" }, { en: "Specify", tr: "Belirlemek, Açıkça ifade etmek" }, { en: "Suggest", tr: "Öne sürmek, Önermek" }, { en: "Tend to", tr: "Eğiliminde olmak" }
                ],
                4: [
                    { en: "Assume", tr: "Varsaymak, Üstlenmek" }, { en: "Justify", tr: "Gerekçelendirmek" }, { en: "Obtain", tr: "Elde etmek" }, { en: "Perceive", tr: "Algılamak" }, { en: "Propose", tr: "Önermek" }, { en: "Deduce", tr: "Sonuç Çıkarmak, Tümdengelim yapmak" }, { en: "Falsify", tr: "Çürütmek, Sahtesini yapmak" }, { en: "Generalize", tr: "Genellemek" }, { en: "Hypothesize", tr: "Hipotez kurmak" }, { en: "Incorporate", tr: "Dahil etmek, Bünyesine katmak" }, { en: "Induce", tr: "Neden olmak, İkna etmek" }
                ]
            },
            "Akademik Sıfatlar": {
                1: [
                    { en: "Cohesive", tr: "Uyumlu, Yapışkan" }, { en: "Comprehensive", tr: "Kapsamlı" }, { en: "Crucial", tr: "Hayati, Çok önemli" }, { en: "Distinct", tr: "Farklı, Belirgin" }, { en: "Essential", tr: "Temel, Zaruri" }, { en: "Explicit", tr: "Açık, Net" }, { en: "Implicit", tr: "Zımni, Dolaylı" }, { en: "Integral", tr: "Bütünleyici, Temel" }, { en: "Subsequent", tr: "Sonraki" }, { en: "Sufficient", tr: "Yeterli" }
                ],
                2: [
                    { en: "Adequate", tr: "Yeterli" }, { en: "Ambiguous", tr: "Belirsiz, Muğlak" }, { en: "Compelling", tr: "Zorlayıcı, İkna edici" }, { en: "Conclusive", tr: "Kesin, Nihai" }, { en: "Contradictory", tr: "Çelişkili" }, { en: "Definitive", tr: "Tanımlayıcı, Kesin" }, { en: "Empirical", tr: "Deneysel, Ampirik" }, { en: "Fluctuating", tr: "Dalgalanan" }, { en: "Irrelevant", tr: "Alakasız" }, { en: "Mitigating", tr: "Hafifletici" }
                ]
            },
            "Akademik İsimler": {
                1: [
                    { en: "Environment", tr: "Çevre" }, { en: "Issue", tr: "Mesele, Konu" }, { en: "Impact", tr: "Etki" }, { en: "Source", tr: "Kaynak" }, { en: "Basis", tr: "Temel, Dayanak" }, { en: "Context", tr: "Bağlam" }, { en: "Strategy", tr: "Strateji" }, { en: "Data", tr: "Veri" }, { en: "Concept", tr: "Kavram" }, { en: "Evidence", tr: "Kanıt" }
                ],
                2: [
                    { en: "Acquisition", tr: "Edinme, Kazanım" }, { en: "Allocation", tr: "Tahsis, Ayırma" }, { en: "Assumption", tr: "Varsayım" }, { en: "Dissemination", tr: "Yayınlama, Yayma" }, { en: "Paradigm", tr: "Paradigma, Örnek Model" }
                ]
            },
            "Akademik Bağlaçlar": {
                1: [
                    { en: "However", tr: "Ancak, Yine de" }, { en: "Moreover", tr: "Dahası, Üstelik" }, { en: "Therefore", tr: "Bu nedenle, Dolayısıyla" }, { en: "Conversely", tr: "Aksine, Tersine" }, { en: "In addition", tr: "Ek olarak" }
                ]
            },
            "Öbek Fiiller": {
                1: [ 
                    { en: "Set up", tr: "Kurmak, Oluşturmak" }, { en: "Break down", tr: "Bozulmak, Parçalamak" }, { en: "Come up with", tr: "Fikir bulmak, Ortaya atmak" }, { en: "Go through", tr: "Yaşamak, Deneyimlemek" }, { en: "Run into", tr: "Karşılaşmak" }, { en: "Turn down", tr: "Reddetmek" } 
                ] 
            },
            "Akademik Zarflar": { 
                1: [ 
                    { en: "Significantly", tr: "Önemli ölçüde" }, { en: "Consequently", tr: "Sonuçsal olarak" }, { en: "Primarily", tr: "Öncelikle, Başlıca" }, { en: "Subsequently", tr: "Daha sonra, Ardından" }, { en: "Necessarily", tr: "Mutlaka, Zorunlu olarak" }, { en: "Conversely", tr: "Aksine, Tersine" } 
                ], 
                2: [ 
                    { en: "Explicitly", tr: "Açıkça" }, { en: "Implicitly", tr: "Zımnen, Dolaylı olarak" }, { en: "Tentatively", tr: "Geçici olarak, Deneme amaçlı" }, { en: "Vaguely", tr: "Bulanık bir şekilde, Belirsizce" } 
                ] 
            }, 
            "En Çok Kullanılan İsimler": { 
                1: [ 
                    { en: "Environment", tr: "Çevre" }, { en: "Issue", tr: "Mesele, Konu" }, { en: "Impact", tr: "Etki" }, { en: "Source", tr: "Kaynak" }, { en: "Basis", tr: "Temel, Dayanak" }, { en: "Context", tr: "Bağlam" }, { en: "Strategy", tr: "Strateji" }, { en: "Data", tr: "Veri" }, { en: "Concept", tr: "Kavram" }, { en: "Evidence", tr: "Kanıt" } 
                ] 
            } 
        };

        const dummyWordsTurkish = ["geliştirmek", "değerlendirmek", "uygulamak", "oluşturmak", "incelemek", "yansıtmak", "ilişkilendirmek", "ayırt etmek", "doğrulamak", "üretmek", "gelişmek", "kapsamak", "önce gelmek", "başarılı olmak", "alıntı yapmak", "bütünleştirmek", "değiştirmek", "tekrarlamak", "ifade etmek", "açıklamak", "değer biçmek", "katkıda bulunmak", "vurgulamak", "hipotez kurmak", "gerekçelendirmek", "ortaya çıkarmak", "öngörmek", "dışlamak", "harcamak", "kolaylaştırmak", "dalgalanmak", "teşvik etmek", "engellemek", "ima etmek", "maruz kalmak", "çıkarım yapmak", "engellemek", "başlatmak", "yenilik yapmak", "eklemek", "müdahale etmek", "zorunlu kılmak", "arabuluculuk yapmak", "birleştirmek", "küçültmek", "yadsımak", "müzakere etmek", "elde etmek", "oluşmak", "atlamak", "denetlemek", "paralellik kurmak", "katılmak", "izin vermek", "ilişkili olmak", "aşamalara ayırmak", "varsaymak", "tahmin etmek", "önermek", "sanmak", "yaygın olmak", "ilerlemek", "yasaklamak", "yayınlamak", "harekete geçirmek", "iddia etmek", "niteliklerini belirtmek"];
        
        // UTILITY FUNCTIONS
        
        // Array karıştırma fonksiyonu (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateExampleSentence(word) {
            const examples = {
                "Analyze": "The research team must carefully analyze the data before drawing a conclusion.",
                "Identify": "We need to identify the core causes of the problem.",
                "Determine": "The committee will determine the final grade based on performance.",
                "Formulate": "She helped formulate a new strategy for the project.",
                "Acquire": "Students acquire new vocabulary through regular practice.",
                "Basis": "Evidence is the basis of any scientific argument.",
                "Context": "Always consider the context of a quotation.",
                "Cohesive": "The policy must be cohesive to guarantee success.",
                "However": "Initial results were promising; however, further testing is required.",
                "Cancel": "The event had to be canceled at the last minute due to the storm.",
                "Significantly": "The new treatment significantly reduced the symptoms.",
                "Environment": "Protecting the natural environment is crucial for our future.",
            };
            return examples[word] || `The study attempts to highlight how to properly use the term **${word.toUpperCase()}** in academic writing.`;
        }

        function generateExampleSentenceTR(wordTR) {
            const examplesTR = {
                "Analiz Etmek": "Araştırma ekibi, sonuca varmadan önce verileri dikkatlice analiz etmelidir.",
                "Tanımlamak, Belirlemek": "Sorunun temel nedenlerini belirlemeliyiz.",
                "Saptamak, Karar Vermek": "Komite, performansa göre son notu belirleyecek.",
                "Formüle Etmek, Geliştirmek": "Proje için yeni bir strateji formüle etmeye yardımcı oldu.",
                "Edinmek, Kazanmak": "Öğrenciler düzenli pratikle yeni kelimeler edinir.",
                "Temel, Dayanak": "Kanıt, herhangi bir bilimsel argümanın temelidir.",
                "Bağlam": "Her zaman bir alıntının bağlamını göz önünde bulundurun.",
                "Uyumlu, Yapışkan": "Başarıyı garantilemek için politika uyumlu olmalıdır.",
                "Ancak, Yine de": "İlk sonuçlar umut vericiydi; ancak, daha fazla test gerekiyor.",
                "İptal etmek": "Fırtına nedeniyle etkinlik son dakikada iptal edilmek zorunda kaldı.",
                "Önemli ölçüde": "Yeni tedavi, semptomları önemli ölçüde azalttı.",
                "Çevre": "Doğal çevreyi korumak geleceğimiz için çok önemlidir.",
            }; 
            // Sahte çevirileri de küçük harf yap
            return examplesTR[wordTR] || `Çalışma, ${wordTR.toLowerCase()} teriminin akademik yazımda nasıl doğru kullanılacağını vurgulamaya çalışmaktadır.`;
        }

        // Tüm kelime verisini istatistik ve renklendirme için işler
        function processWordData() {
            Object.keys(realWordData).forEach(category => {
                cardUnitData[category] = Object.keys(realWordData[category]).map(unitKey => {
                    const unitNum = parseInt(unitKey);
                    let words = realWordData[category][unitNum];

                    // Sahte kelime oluşturma mantığını gerçek veri varsa bypass et
                    if (!words || words.length === 0) {
                        const numWords = Math.floor(Math.random() * 7) + 4;
                        const shuffledPool = shuffleArray([...globalTranslationPool]);
                        words = Array(numWords).fill(0).map((__, wIndex) => {
                            let dummyTR = shuffledPool.length > 0 ? shuffledPool[(unitNum * wIndex) % shuffledPool.length] : dummyWordsTurkish[Math.floor(Math.random() * dummyWordsTurkish.length)];
                            const baseWord = category.split(' ')[0].substring(0, 3).toUpperCase();
                            const enWord = `${baseWord}_U${unitNum}_W${wIndex + 1}`;
                            return { en: enWord, tr: dummyTR.charAt(0).toUpperCase() + dummyTR.slice(1) }; // Başlık durumu için
                        });
                    }

                    // Global çeviri havuzunu doldur
                    words.forEach(w => {
                        if (w.tr && !globalTranslationPool.includes(w.tr)) {
                            globalTranslationPool.push(w.tr);
                        }
                    });

                    // Örnek cümle ekle
                    words = words.map(w => ({ ...w, exampleEN: generateExampleSentence(w.en), exampleTR: generateExampleSentenceTR(w.tr) }));

                    // Öğrenilmiş kelime sayısını simüle et
                    let learnedWords = 0;
                    if (unitNum === 1 && (category === "Akademik Fiiller" || category === "İleri Düzey Akademik Fiiller")) learnedWords = Math.min(words.length, 5);
                    else if (unitNum === 2 && category === "Akademik Fiiller") learnedWords = Math.min(words.length, 5);
                    else if (unitNum === 3 && category === "İleri Düzey Akademik Fiiller") learnedWords = Math.min(words.length, 2);
                    else if (unitNum === 4 && category === "İleri Düzey Akademik Fiiller") learnedWords = Math.min(words.length, 1);
                    else if (unitNum === 1 && category === "Akademik Sıfatlar") learnedWords = Math.min(words.length, 3);
                    
                    const progress = words.length > 0 ? (learnedWords / words.length) * 100 : 0;
                    const colorClass = `u${(unitNum - 1) % 5 + 1}`;
                    return { unit: unitNum, totalWords: words.length, learnedWords: learnedWords, words: words, progress: progress, colorClass: colorClass };
                });
            });
        }

        function updateHomePageCards() {
            document.querySelectorAll('#home-page .card').forEach(card => {
                const title = card.querySelector('h3').textContent;
                const info = cardUnitData[title];
                if (info) {
                    let totalWords = 0;
                    let totalLearned = 0;
                    info.forEach(unit => {
                        totalWords += unit.totalWords;
                        totalLearned += unit.learnedWords;
                    });
                    const percentage = totalWords > 0 ? (totalLearned / totalWords) * 100 : 0;
                    card.querySelector('.card-info p').textContent = `${totalLearned}/${totalWords} kelime öğrenildi`;
                    card.querySelector('.progress-fill').style.width = `${percentage}%`;
                }
            });
        }

        // === SAYFA NAVİGASYON VE YÜKLEME FONKSİYONLARI ===

        function navigateTo(targetPageId, level, title) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(targetPageId).classList.add('active');

            if (targetPageId === 'home-page') {
                backButton.style.display = 'none';
                headerTitle.textContent = 'EnglishBox';
                navigationStack = [{ id: 'home-page', level: 0, title: 'EnglishBox' }];
            } else {
                backButton.style.display = 'inline-flex';
                backButton.setAttribute('data-page-level', level);
                headerTitle.textContent = title;
                headerTitle.style.marginLeft = '0';
                const lastState = navigationStack[navigationStack.length - 1];

                if (!lastState || lastState.id !== targetPageId || lastState.title !== title) { 
                    navigationStack.push({ id: targetPageId, level: level, title: title });
                }
            }
        }

        function goBack() {
            if (navigationStack.length > 1) {
                navigationStack.pop();
                const prevPage = navigationStack[navigationStack.length - 1];
                
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => page.classList.remove('active'));
                document.getElementById(prevPage.id).classList.add('active');
                headerTitle.textContent = prevPage.title;
                backButton.setAttribute('data-page-level', prevPage.level);

                if (prevPage.id === 'home-page') {
                    backButton.style.display = 'none';
                    headerTitle.textContent = 'EnglishBox';
                }

                // Quiz sonuçlarını geri dönerken temizle
                const results = document.querySelector('#quiz-page .quiz-results');
                if (results) {
                    results.remove();
                    document.querySelector('.quiz-header-word').style.display = 'flex';
                }

                // Detay sayfasına (L1) geri dönülüyorsa, ünitenin seçili kalması için timeline'ı yeniden yükle
                if (prevPage.id === 'detail-page' && currentCategoryTitle) {
                    loadTimeline(cardUnitData[currentCategoryTitle], currentCategoryTitle);
                }
            } else if (navigationStack.length === 1 && navigationStack[0].id !== 'home-page') {
                // Sadece home'a dönüş varsa, stack'i temizle ve home'a git
                navigationStack.pop();
                navigateTo('home-page', 0, 'EnglishBox');
            }
        }

        // Kategori detay sayfasını yükler (Ünite listesi)
        function loadDetailPage(categoryTitle) {
            currentCategoryTitle = categoryTitle;
            const unitData = cardUnitData[categoryTitle];
            
            // İstatistikleri simüle et
            let totalWords = 0;
            let totalLearned = 0;
            unitData.forEach(unit => {
                totalWords += unit.totalWords;
                totalLearned += unit.learnedWords;
            });
            const correctRate = totalWords > 0 ? (totalLearned / totalWords) * 100 : 0;

            document.getElementById('detail-correct-rate').textContent = `% ${correctRate.toFixed(0)}`;
            document.getElementById('detail-learned-rate').textContent = `% ${correctRate.toFixed(0)}`;

            loadTimeline(unitData, categoryTitle);
        }


        function loadUnitDetailPage(unitNum, categoryTitle, totalWords, learnedWords, colorClass, words) {
            currentUnitWords = words;
            currentUnitNumber = unitNum; // Geri dönme için ünite numarasını sakla

            document.getElementById('detail-unit-circle').textContent = unitNum;
            document.getElementById('detail-unit-progress').textContent = `${learnedWords}/${totalWords} kelime öğrenildi`;
            document.getElementById('detail-unit-circle').className = `unit-progress-circle ${colorClass}`;

            const wordListContainer = document.getElementById('word-list-container');
            wordListContainer.innerHTML = '';

            words.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.innerHTML = `
                    <div class="word-icon-placeholder"><i class="fas fa-file-alt"></i></div>
                    <div class="word-text-group">
                        <span class="word-english">${word.en}</span>
                        <span class="word-turkish">${word.tr}</span>
                    </div>
                `;
                wordItem.addEventListener('click', () => {
                    loadWordDetailPage(word, categoryTitle, unitNum);
                    navigateTo('word-detail-page', 3, `${categoryTitle} - Ünite ${unitNum}`);
                });
                wordListContainer.appendChild(wordItem);
            });
        }

        function loadWordDetailPage(word, categoryTitle, unitNum) {
            document.getElementById('detail-english-word').textContent = word.en;
            document.getElementById('detail-turkish-word').textContent = word.tr;
            document.getElementById('example-sentence-en').textContent = word.exampleEN;
            document.getElementById('example-sentence-tr').textContent = word.exampleTR;
        }

        function loadTimeline(unitData, categoryTitle) {
            const unitTimeline = document.querySelector('.timeline');
            unitTimeline.innerHTML = '';
            unitData.forEach(unit => {
                const unitItem = document.createElement('div');
                unitItem.className = `unit-item`;
                unitItem.innerHTML = `
                    <div class="unit-circle ${unit.colorClass}">${unit.unit}</div>
                    <div class="unit-content">
                        <div class="unit-title">Ünite ${unit.unit}</div>
                        <div class="unit-subtitle">${unit.totalWords} Kelime</div>
                        <div class="progress-bar" style="margin-top: 5px;">
                            <div class="progress-fill" style="width: ${unit.progress}%"></div>
                        </div>
                    </div>
                `;
                // Eğer detay sayfasından geri dönülüyorsa, seçili olanı işaretle
                if (unit.unit === currentUnitNumber && currentCategoryTitle === categoryTitle) {
                     unitItem.classList.add('selected');
                }
                
                unitItem.addEventListener('click', () => {
                    document.querySelectorAll('.unit-item').forEach(item => item.classList.remove('selected'));
                    unitItem.classList.add('selected');
                    loadUnitDetailPage(unit.unit, categoryTitle, unit.totalWords, unit.learnedWords, unit.colorClass, unit.words);
                    navigateTo('unit-detail-page', 2, `${categoryTitle} - Ünite ${unit.unit}`);
                });
                unitTimeline.appendChild(unitItem);
            });
        }

        // === QUIZ FONKSİYONLARI ===

        function generateQuiz(wordList) {
            const quiz = [];
            // Büyük havuzdan çevirileri çek (kendi doğru cevabını dahil etme)
            const translationPool = globalTranslationPool.filter(tr => tr);

            wordList.forEach(correctWord => {
                const correctTranslation = correctWord.tr.toLowerCase();
                let options = new Set();
                options.add(correctTranslation); // Doğru cevabı ekle

                // 3 rastgele çeldirici ekle
                while (options.size < 4) {
                    const randomTr = shuffleArray([...translationPool]).find(tr => tr.toLowerCase() !== correctTranslation.toLowerCase()); // Çeldiricinin boş olmamasını ve doğru cevap olmamasını sağla
                    if (randomTr) {
                        options.add(randomTr.toLowerCase());
                    } else if (translationPool.length < 4) { // Havuzda yeterli kelime yoksa döngüden çık
                        break;
                    }
                }
                // Eğer 4 seçenek toplanamazsa (çok küçük kelime havuzu) bu soruyu atla
                if (options.size === 4) {
                    quiz.push({
                        question: correctWord.en,
                        correctAnswer: correctTranslation,
                        options: shuffleArray(Array.from(options)),
                        wordObject: correctWord
                    });
                }
            });
            // Soruların sırasını karıştır
            return shuffleArray(quiz);
        }

        function startQuiz() {
            if (!currentUnitWords || currentUnitWords.length === 0) {
                alert("Quiz başlatılamadı: Bu ünitede kelime yok.");
                return;
            }

            currentQuiz = generateQuiz(currentUnitWords);
            currentQuestionIndex = 0;
            score = 0;
            totalQuestions = currentQuiz.length;

            if (totalQuestions === 0) {
                alert("Quiz sorusu oluşturulamadı. Lütfen kelime havuzunu kontrol edin.");
                return;
            }
            // Önceki sonuçları temizle (Eğer varsa) ve soru başlığını göster
            const results = document.querySelector('#quiz-page .quiz-results');
            if (results) results.remove();
            document.querySelector('.quiz-header-word').style.display = 'flex';

            // Quiz'i başlat
            displayQuestion();
            navigateTo('quiz-page', 3, `${currentCategoryTitle} - Ünite ${currentUnitNumber} Quiz`);
        }
        
        function displayQuestion() {
            const quizQuestionText = document.getElementById('quiz-question-text');
            const quizQuestionCounter = document.getElementById('quiz-question-counter');
            const quizOptionsContainer = document.getElementById('quiz-options');
            quizOptionsContainer.classList.remove('answered');

            if (currentQuestionIndex < totalQuestions) {
                const currentQ = currentQuiz[currentQuestionIndex];
                quizQuestionText.textContent = currentQ.question;
                quizQuestionCounter.textContent = `Soru ${currentQuestionIndex + 1} / ${totalQuestions}`;
                quizOptionsContainer.innerHTML = '';

                currentQ.options.forEach(optionText => {
                    const option = document.createElement('div');
                    option.className = 'quiz-option';
                    option.textContent = optionText;
                    option.onclick = function() {
                        checkAnswer(this, currentQ.correctAnswer);
                    };
                    quizOptionsContainer.appendChild(option);
                });
            } else {
                showResults();
            }
        }

        function checkAnswer(selectedOption, correctAnswer) {
            const quizOptionsContainer = document.getElementById('quiz-options');
            
            // Zaten cevaplanmışsa bir şey yapma
            if (quizOptionsContainer.classList.contains('answered')) return;

            quizOptionsContainer.classList.add('answered');

            if (selectedOption.textContent.toLowerCase() === correctAnswer.toLowerCase()) {
                selectedOption.classList.add('correct');
                score++;
            } else {
                selectedOption.classList.add('incorrect');
                // Doğru cevabı bul ve işaretle
                const correctElement = Array.from(quizOptionsContainer.children).find(opt => opt.textContent.toLowerCase() === correctAnswer.toLowerCase());
                if (correctElement) {
                     correctElement.classList.add('correct');
                }
            }

            setTimeout(() => {
                currentQuestionIndex++;
                displayQuestion();
            }, 1200);
        }

        function showResults() {
            // Sonuçları göster
            const resultsHtml = `
                <div class="quiz-results">
                    <h2>Quiz Tamamlandı!</h2>
                    <div class="results-score-circle" style="background-color: ${score / totalQuestions > 0.7 ? 'var(--color-green)' : 'var(--color-red)'};">
                        ${Math.round((score / totalQuestions) * 100)}%
                    </div>
                    <p>Doğru: ${score}</p>
                    <p>Toplam Soru: ${totalQuestions}</p>
                    <button class="action-button btn-back-to-list" onclick="goBack()" style="margin-top: 20px;"><i class="fas fa-home"></i> Üniteye Geri Dön</button>
                </div>
            `;
            const quizPageContent = document.getElementById('quiz-page');
            document.querySelector('.quiz-header-word').style.display = 'none';
            quizPageContent.insertAdjacentHTML('beforeend', resultsHtml);
        }


        document.addEventListener('DOMContentLoaded', () => {
            processWordData();
            updateHomePageCards();
            navigateTo('home-page', 0, 'EnglishBox'); // Uygulamayı başlat
        });

        backButton.addEventListener('click', goBack);

        cards.forEach(card => {
            const categoryTitle = card.querySelector('h3').textContent;
            const continueButton = card.querySelector('.btn-continue');
            const clickHandler = (e) => {
                if(e && e.stopPropagation) e.stopPropagation();
                currentCategoryTitle = categoryTitle;
                loadDetailPage(categoryTitle);
                navigateTo('detail-page', 1, categoryTitle);
            };
            continueButton.addEventListener('click', clickHandler);
            card.addEventListener('click', clickHandler); // Tüm kart alanına tıklandığında da çalışsın
        });
    </script>
</body>
</html>
